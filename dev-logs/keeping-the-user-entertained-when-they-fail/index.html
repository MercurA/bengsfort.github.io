<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width initial-scale=1">
	
		<title>Keeping the player entertained when they fail</title>
	
		<!--// Metadata //-->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width initial-scale=1">
	
		<!--// Metadata //-->
		<meta name="description" content="Words and thoughts about app development, indie game development, and pixel art.">
		<meta property="og:type" content="website">
		<meta property="og:title" content="Developmental Pixels">
		<meta property="og:url" content="http://aesinv.com/index.html">
		<meta property="og:site_name" content="Developmental Pixels">
		<meta property="og:description" content="Words and thoughts about app development, indie game development, and pixel art.">
		<meta name="twitter:card" content="summary">
		<meta name="twitter:title" content="Developmental Pixels">
		<meta name="twitter:description" content="Words and thoughts about app development, indie game development, and pixel art.">
		<meta name="twitter:creator" content="@bengsfort">
		<meta property="fb:admins" content="100000177595822">
		<meta property="fb:app_id" content="1893256420958255">
		
		
		<!--// Stylesheets //-->
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link href="/styles/main.css" rel="stylesheet">
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/atom-one-dark.min.css">
	</head>
	<body>
		<header>
			<a class="nav-menu-trigger waves-effect waves-light" data-target=".nav-pane">
				<i class="material-icons close">close</i>
				<i class="material-icons open">menu</i>
			</a>
			<div class="nav-pane">
				<div class="nav-content">
					<div class="author-card">
						<div class="author-card-top">
							<div class="author-avatar-wrapper">
								<img class="author-avatar" src="/assets/avatar.png" alt="Matt Bengston" />
							</div>
						</div>
					
						<div class="author-card-body">
							<h5 class="author-name">Matt Bengston</h5>
							
							<div class="author-job-info">
								<span class="author-position">Software Developer</span>
								<a class="author-employer" target="_blank" href="https://unity3d.com">@Unity Technologies</a>
							</div>
					
							<div class="author-social">
								<a class="author-github" target="_blank" href="https://github.com/bengsfort">
									<svg class="icon icon-github-with-circle">
										<use xlink:href="#icon-github-with-circle" />
									</svg>
								</a>
								<a class="author-twitter" target="_blank" href="https://twitter.com/bengsfort">
									<svg class="icon icon-twitter-with-circle">
										<use xlink:href="#icon-twitter-with-circle" />
									</svg>
								</a>
							</div>
						</div>
					</div>			<nav id="site-navigation">
						<ul class="site-nav">
								<li >
									<a href="/" class="waves-effect">All Posts</a>
								</li>
								<li >
									<a href="/articles/" class="waves-effect">Articles</a>
								</li>
								<li class="active">
									<a href="/dev-logs/" class="waves-effect">Dev Logs</a>
								</li>
								<li >
									<a href="/pixel-art/" class="waves-effect">Pixel Art</a>
								</li>
								<li >
									<a href="/about/" class="waves-effect">About</a>
								</li>
						</ul>
					</nav>		</div>
				<div class="nav-footer">
					<span class="copyright-info"><i class="tiny material-icons">copyright</i> Matt Bengston</span>
					<span class="source-info"><a href="https://github.com/bengsfort/bengsfort.github.io" target="_blank"><i class="tiny material-icons">code</i> View on Github</a></span>
				</div>	</div>
		</header>
		<main class="main-wrapper">
			<div class="container">
				<section class="intro-text">
					<h1 class="headline">Keeping the player entertained when they fail</h1>
						<span class="subtitle">I really want to polish off this game as much as possible, so today we&#x27;re taking a look at what happens when the user falls off the current stage into the oblivion.</span>
				</section>				<p>I&#39;m quickly discovering that games are just like really complex or unmaintained websites: as you progress you quickly find that there are a lot more scenarios and screens you need to deal with that never even crossed your mind when you started. For me one of these was <em>&quot;Wait, what happens when the player falls off a platform?&quot;</em> I knew it was always something that was going to happen, especially considering the game is inspired by <em>Super Monkey Ball</em>, but I had never actually taken the time to figure out what would happen on the screen.</p>
<p>Considering I want to polish the game as much as possible and have it stand out from other mobile games, some hard cut back to the spawn point was way out of the question. Since the playable character is literally just a ball there&#39;s really no fancy animations I can have him do. With that in mind, I came up with the idea of the camera stopping shortly after falling off but continuing to look in the direction of the player, wherever he is, and then making up for the lack of animations with some UI overlay.</p>
<h2 id="dealing-with-the-physics">Dealing with the physics</h2>
<p>First I had to actually write in the player respawn scripts, which turned out to be the most difficult by far. After creating some large triggers underneath the stage area I wound up wasting a good few hours trying to figure out why my collision events wouldn&#39;t fire, but discovered that I hilariously had my console filtered to error messages only. After that revelation things didn&#39;t get easier though, as it turns out updating a <a href="http://docs.unity3d.com/ScriptReference/Rigidbody.html">Rigidbody</a>&#39;s position in Unity when it&#39;s under heavy force is more involved than simply updating it&#39;s coordinates.</p>
<p>Aside from updating positions, it turns out you also need to zero out the objects <a href="http://docs.unity3d.com/ScriptReference/Rigidbody-velocity.html">velocity</a> so they don&#39;t respawn and continue to fly through the air at supersonic speeds. Furthermore, it turns out Unity has a quirk where you also have to deactivate / activate the <a href="http://docs.unity3d.com/ScriptReference/Rigidbody.html">Rigidbody</a>. Without this hard reset the rigidbody can experience some really bizarre and jerky movement patterns after it&#39;s been repositioned absolutely via transform rather than physics.</p>
<pre><code class="hljs javascript"><span class="hljs-comment">// Pause the object</span>
rb.velocity = Vector3.zero;
rb.angularVelocity = Vector3.zero;
rb.useGravity = <span class="hljs-literal">false</span>;
rb.isKinematic = <span class="hljs-literal">true</span>;

<span class="hljs-comment">// Update to the new position</span>
transform.position = respawnPoint;
origin.transform.rotation = Quaternion.identity;

<span class="hljs-comment">// Unpause the object, including a hard activate reset</span>
gameObject.SetActive(<span class="hljs-literal">false</span>);
gameObject.SetActive(<span class="hljs-literal">true</span>);
rb.useGravity = <span class="hljs-literal">true</span>;
rb.isKinematic = <span class="hljs-literal">false</span>;</code></pre>

<p>It&#39;s not the prettiest code, but it works flawlessly. Plus as an added bonus I didn&#39;t really have to do any more legwork for the camera and player origin since they&#39;re directly relational to the position of the player object. I wound up breaking these blocks up into their own separate public functions so I could also re-use them for when I implement pausing the game (which is already implemented in a very rudimentary state as a result of this).</p>
<pre><code class="hljs javascript">public <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pause</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// pause the object</span>
    rb.velocity = Vector3.zero;
    rb.angularVelocity = Vector3.zero;
    rb.useGravity = <span class="hljs-literal">false</span>;
    rb.isKinematic = <span class="hljs-literal">true</span>;
}

public <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unpause</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// unpause the object, including a hard activate reset</span>
    gameObject.SetActive(<span class="hljs-literal">false</span>);
    gameObject.SetActive(<span class="hljs-literal">true</span>);
    rb.useGravity = <span class="hljs-literal">true</span>;
    rb.isKinematic = <span class="hljs-literal">false</span>;
}

public <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">respawn</span>(<span class="hljs-params"></span>) </span>{
    pause();

    <span class="hljs-comment">// Update to the new position</span>
    transform.position = respawnPoint;
    origin.transform.rotation = Quaternion.identity;

    unpause();
}</code></pre>

<h2 id="freezing-the-camera-until-respawn">Freezing the camera until respawn</h2>
<p>Getting the detached camera functionality wound up being far easier than I anticipated, however it required quite a bit of refactoring of my main camera script. I ended up creating a state property that would dictate what the camera should be doing at that moment; then created methods for each state. Detaching is essentially just unbinding the position from the players position and continuing to fire <a href="http://docs.unity3d.com/ScriptReference/Transform.LookAt.html">LookAt</a> so the camera will maintain its gaze on the user as he plummets to certain doom.</p>
<h2 id="creating-an-overlay">Creating an overlay</h2>
<p>There were two elements I to the overlay that I really wanted to capture:</p>
<ol>
<li>An amusing message that would (hopefully) keep the user entertained.</li>
<li>A similarly amusing image of our main <em>character</em> looking battered and bruised.</li>
</ol>
<p><img src="/assets/game-respawn/respawn-screen.png" alt="The completed overlay"></p>
<h3 id="amusing-variety">Amusing variety</h3>
<p>Keeping with the idea of details, I didn&#39;t want to just toss in a static text field and be done with it. Having an array of potential messages and randomly choosing one to show to the user seemed far more appealing, so that&#39;s what I went ahead and did. That way there would be a sense of variety and spontaneity, rather than a predictable and boring preset message.</p>
<p>Thanks to Unity&#39;s public variable configuration this was cake. I just set a public variable to be an array of Strings (<code>String[]</code>), then in my <code>Start()</code> method have it generate a random number between zero and the length of the array, using that number to extract a message from the array and apply it to the text field. Done!</p>
<h3 id="adding-the-character-into-the-mix">Adding the character into the mix</h3>
<p>Creating a variant of the main character to take a render of was extremely fun, and surprisingly didn&#39;t take too long. I took his base texture and created an alternate version with far more bummed out eyes and tons of scratches/bruises all over him, tossed it into Unity and snagged a screenshot of him in front of a green cube so I could toss that into Photoshop and get a clean transparent picture.</p>
<p><img src="/assets/game-respawn/injured-player-resized.png" alt="The result of the character render"></p>
<h3 id="animating-and-finishing-up-ui">Animating and finishing up UI</h3>
<p>In case you haven&#39;t picked up on this yet, but I think static is boring. The more moving things the better! It was time to animate this screen for extra fancy points, so I loaded up the character image into Unity and opened up the <a href="http://docs.unity3d.com/Manual/class-Animator.html">Animator</a> window for the first time on this project. I actually really enjoyed using it, it reminded me a lot of my Flash and video editing days way back when so it was super easy and quick to get up-to-speed with.</p>
<p>I wound up not having to use the states feature at all as there was only one state, and I was using the animations as transitions for the game objects when first activated. The only snag was making sure to turn off looping, which wasn&#39;t as apparent as I would have expected it to be.</p>
<h3 id="putting-it-all-together">Putting it all together</h3>
<p>While bundling everything together wasn&#39;t necessarily difficult it did require quite a large amount of refactoring so I could get everything centralized. This involved creating a lot of public methods and finally busting out my <code>LevelController</code> script which I&#39;m using for controlling and maintaining level-related data.</p>
<p>I cached the player/camera/timer objects and controllers in my level controller and started thinking up exactly what would need to happen so I could start creating public methods in the respective controllers. I wound up with the following:</p>
<ol>
<li>Pause the timer (<code>Timer Controller</code>)</li>
<li>Lock the camera (<code>Camera Controller</code>)</li>
<li>Activate the overlay (<code>Level Controller</code>)</li>
<li>Pause, reset, and respawn the player (<code>Player Controller</code>)</li>
<li>Re-bind the camera to the player (<code>Camera Controller</code>)</li>
<li>Restart the timer (<code>Timer Controller</code>)</li>
</ol>
<p>Since this is all pretty cut and dry and taking easy functionality and tossing it into public functions, we&#39;ll just focus on the interesting bits of the level controller.</p>
<p>Whenever the player hits the out of bounds collision trigger, I made the object fire off the <code>playerFell()</code> method of the Level Controller, which is as follows:</p>
<pre><code class="hljs javascript">public <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">playerFell</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// Freeze the camera and pause the timer</span>
    cameraController.freezeCamera();
    gameTimer.stopTimer();

    <span class="hljs-comment">// Load the overlay from resources and toss it into the interface canvas</span>
    <span class="hljs-keyword">var</span> fellOverlay : GameObject = Instantiate(Resources.Load(<span class="hljs-string">"fell-screen"</span>, GameObject));
    fellOverlay.transform.SetParent(canvas.transform, <span class="hljs-literal">false</span>);

    <span class="hljs-comment">// Let's let the player contemplate what went wrong</span>
    <span class="hljs-keyword">yield</span> WaitForSeconds(<span class="hljs-number">3.5</span>);

    <span class="hljs-comment">// Remove the overlay and restart everything</span>
    Destroy(fellOverlay);
    playerController.respawn();
    cameraController.unfreezeCamera();
    gameTimer.Restart();
}</code></pre>

<p>Essentially, we&#39;re freezing the state of the game for 3.5 seconds to load and show the &quot;you failed&quot; overlay then resetting everything back to the original positions/values when the level started. As we saw up when we were fooling with the player controller above, there&#39;s quite a bit more going on however since everything is isolated into their own public methods it makes the main script a lot more easy to comprehend. The most interesting thing here is that I decided to load the overlay as a prefabbed resource. This is because <a href="https://youtu.be/vnF9YEm_pxk?t=29m28s">resources don&#39;t take up memory on mobile devices until instantiated</a>, so the overlay isn&#39;t hogging any necessary memory when it&#39;s not active.</p>
<div class="bg-video-wrap" style="background-image: url('/assets/entertaining-player-when-they-fail.gif');">
  <video class="bg-video-player" autoplay loop>
    <source src="/assets/videos/entertaining-player-when-they-fail.mp4"  type="video/mp4; codecs=avc1.42E01E,mp4a.40.2">
    <source src="/assets/videos/entertaining-player-when-they-fail.webm" type="video/webm; codecs=vp8,vorbis">
  </video>
</div>

<p>That&#39;s all for this episode of the dev log. I hope you enjoyed it, make sure to check out the other parts below:</p>
<ol>
<li>From concept to reality</li>
<li>Trying a new look</li>
<li>Another player package refactor</li>
<li>Keeping the user entertained when they fail</li>
</ol>

			</div>
		</main>

		<svg style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
		  <defs>
		    <symbol id="icon-github-with-circle" viewBox="0 0 20 20">
		      <title>github-with-circle</title>
		      <path class="path1" d="M10.015 9.949c0 0-0.010 0-0.015 0h-0.015c-1.191 0-2.24-0.303-2.861 0.268-0.371 0.342-0.527 0.754-0.527 1.197 0 1.852 1.483 2.080 3.389 2.080h0.029c1.905 0 3.389-0.229 3.389-2.080 0-0.443-0.156-0.856-0.527-1.197-0.622-0.571-1.671-0.268-2.862-0.268zM8.393 12.48c-0.363 0-0.656-0.408-0.656-0.91s0.293-0.908 0.656-0.908c0.363 0 0.657 0.406 0.657 0.908s-0.293 0.91-0.657 0.91zM11.606 12.48c-0.363 0-0.657-0.408-0.657-0.91s0.294-0.908 0.657-0.908c0.362 0 0.656 0.406 0.656 0.908s-0.293 0.91-0.656 0.91zM10 0.4c-5.302 0-9.6 4.298-9.6 9.6s4.298 9.6 9.6 9.6 9.6-4.298 9.6-9.6-4.298-9.6-9.6-9.6zM10.876 13.939c-0.172 0-0.514 0-0.876 0.002-0.362-0.002-0.704-0.002-0.876-0.002-0.76 0-3.772-0.059-3.772-3.689 0-0.834 0.286-1.445 0.755-1.955-0.074-0.184-0.078-1.232 0.32-2.236 0 0 0.916 0.1 2.301 1.051 0.289-0.081 0.781-0.122 1.272-0.122s0.982 0.041 1.273 0.121c1.385-0.951 2.301-1.051 2.301-1.051 0.398 1.004 0.395 2.053 0.32 2.236 0.469 0.51 0.755 1.121 0.755 1.955-0.001 3.632-3.013 3.69-3.773 3.69z"></path>
		    </symbol>
		    <symbol id="icon-twitter-with-circle" viewBox="0 0 20 20">
		      <title>twitter-with-circle</title>
		      <path class="path1" d="M10 0.4c-5.302 0-9.6 4.298-9.6 9.6s4.298 9.6 9.6 9.6 9.6-4.298 9.6-9.6-4.298-9.6-9.6-9.6zM13.905 8.264c0.004 0.082 0.005 0.164 0.005 0.244 0 2.5-1.901 5.381-5.379 5.381-1.068 0-2.062-0.312-2.898-0.85 0.147 0.018 0.298 0.025 0.451 0.025 0.886 0 1.701-0.301 2.348-0.809-0.827-0.016-1.525-0.562-1.766-1.312 0.115 0.021 0.233 0.033 0.355 0.033 0.172 0 0.34-0.023 0.498-0.066-0.865-0.174-1.517-0.938-1.517-1.854v-0.023c0.255 0.141 0.547 0.227 0.857 0.237-0.508-0.34-0.841-0.918-0.841-1.575 0-0.346 0.093-0.672 0.256-0.951 0.933 1.144 2.325 1.896 3.897 1.977-0.033-0.139-0.049-0.283-0.049-0.432 0-1.043 0.846-1.891 1.891-1.891 0.543 0 1.035 0.23 1.38 0.598 0.431-0.086 0.835-0.242 1.2-0.459-0.141 0.441-0.44 0.812-0.831 1.047 0.383-0.047 0.747-0.148 1.086-0.299-0.253 0.379-0.574 0.713-0.943 0.979z"></path>
		    </symbol>
		  </defs>
		</svg>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="/js/bin/materialize.min.js"></script>
		<script type="text/javascript">
			var trigger = $('.nav-menu-trigger'),
				target = $(trigger.data('target'));
			
			trigger.on('click', function() {
				trigger.toggleClass('active');
				target.toggleClass('in');
			});
		</script>		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		
		  ga('create', 'UA-66600710-1', 'auto');
		  ga('send', 'pageview');
		</script>
	</body>
</html>