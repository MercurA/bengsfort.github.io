<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Building a Gulp workflow wrapped around Jekyll | Code &amp; Stuff</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Tl;dr

Jekyll is analog out of the box, a Gulp workflow allows you to simplify development massively.
Use either child_process.spawn or child_process.exec to run the Jekyll build from Node/Gulp.
A way">
<meta property="og:type" content="article">
<meta property="og:title" content="Building a Gulp workflow wrapped around Jekyll">
<meta property="og:url" content="http://aesinv.com/development/building-a-gulp-workflow-around-jekyll/index.html">
<meta property="og:site_name" content="Code & Stuff">
<meta property="og:description" content="Tl;dr

Jekyll is analog out of the box, a Gulp workflow allows you to simplify development massively.
Use either child_process.spawn or child_process.exec to run the Jekyll build from Node/Gulp.
A way">
<meta property="og:updated_time" content="2017-03-06T13:35:41.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Building a Gulp workflow wrapped around Jekyll">
<meta name="twitter:description" content="Tl;dr

Jekyll is analog out of the box, a Gulp workflow allows you to simplify development massively.
Use either child_process.spawn or child_process.exec to run the Jekyll build from Node/Gulp.
A way">
  
    <link rel="alternate" href="/atom.xml" title="Code &amp; Stuff" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Code &amp; Stuff</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://aesinv.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-building-a-gulp-workflow-around-jekyll" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/development/building-a-gulp-workflow-around-jekyll/" class="article-date">
  <time datetime="2015-08-29T14:16:21.000Z" itemprop="datePublished">29 August, 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/development/">development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Building a Gulp workflow wrapped around Jekyll
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Tl-dr"><a href="#Tl-dr" class="headerlink" title="Tl;dr"></a>Tl;dr</h2><blockquote>
<ul>
<li>Jekyll is analog out of the box, a Gulp workflow allows you to simplify development massively.</li>
<li>Use either <a href="https://nodejs.org/api/child_process.html#child_process_child_process_spawn_command_args_options" target="_blank" rel="external">child_process.spawn</a> or <a href="https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback" target="_blank" rel="external">child_process.exec</a> to run the Jekyll build from Node/Gulp.</li>
<li>A way of sequencing your tasks is crucial to the build. I currently use <a href="https://www.npmjs.com/package/run-sequence" target="_blank" rel="external">runSequence</a> but am looking at refactoring.</li>
<li>View the <a href="https://github.com/aesinv/aesinv-jekyll-blog/blob/master/gulpfile.js" target="_blank" rel="external">Completed Gulpfile</a> on <a href="https://github.com/aesinv/aesinv-jekyll-blog/" target="_blank" rel="external">GitHub</a>.</li>
</ul>
</blockquote>
<h2 id="The-Problem"><a href="#The-Problem" class="headerlink" title="The Problem"></a>The Problem</h2><p>Out of the box, <a href="http://jekyllrb.com/" target="_blank" rel="external">Jekyll</a> comes with everything you’d need to set up a simple, fully static website. When it comes time to add some dynamism however, things become quite analog. The default set up is very set in stone, and while you can add directories and files to include on compilation to your <code>_config.yml</code> file, if you want to delve into the realm of actual optimization of said included files you have to jump into <em>lots of pizza and a full night of Ruby</em> land. As a front end developer with no previous experience in <a href="https://www.ruby-lang.org/en/" target="_blank" rel="external">Ruby</a>, this wasn’t an appealing option for me (especially considering I can hardly stand even setting up <a href="https://rvm.io/" target="_blank" rel="external">RVM</a>).</p>
<p>Ideally then, this should be handled via a solid task manager such as <a href="http://gulpjs.com/" target="_blank" rel="external">Gulp</a> that would allow me to toss in any optimizations I’d like with minimal effort. While there are tons of <a href="http://yeoman.io" target="_blank" rel="external">Yeoman</a> generators out there, where’s the fun in that?! Setting up a Gulp workflow is very straightforward and in some cases <em>quite fun</em> (I’m not supposed to let people see me say that or something, right?), however the problem of how to get it to interact nicely with Jekyll persists.</p>
<h2 id="Determining-what-handles-what"><a href="#Determining-what-handles-what" class="headerlink" title="Determining what handles what"></a>Determining what handles what</h2><p>Since Jekyll spins up it’s own build as well as a local development server and is required to generate the finished site, it’s clearly necessary to determine what should be handling what. Since running the <code>jekyll serve</code> command in parallel with Gulp would wind up with the two stepping on each others toes, that idea quickly got thrown out the window in favor for Gulp handling the majority of the legwork while the Jekyll build would be reserved strictly for site generation.</p>
<p>So, let’s start with what Jekyll can do right out of the box:</p>
<ul>
<li><a href="http://sass-lang.com/" target="_blank" rel="external">Sass</a> compilation</li>
<li>Markup / <a href="http://daringfireball.net/projects/markdown/" target="_blank" rel="external">Markdown</a> / Data compilation and site generation</li>
<li>Destination directory cleaning</li>
<li>Copying project source directories and files that are marked for inclusion</li>
<li>Spinning up a local dev server that auto re-gens on source file changes</li>
</ul>
<p>Because Jekyll cleans the destination directory with each build and I’m not a huge fan of compiled build files hanging out and partying with source files, any extra tasks being handled by Gulp need to be run after the Jekyll build every time, with the built files then being injected into the build directory. Since Gulp will be handling the local server, there’s no need to worry about that particular task. Additionally, to prevent requiring a full Jekyll/Asset re-build on simple stylesheet changes, that’s another thing that we can transfer responsibility over to Gulp. Gulp can then handle tacking on some extra CSS stuff (such as <a href="https://www.npmjs.com/package/gulp-minify-css" target="_blank" rel="external">minification</a> and <a href="https://www.npmjs.com/package/gulp-autoprefixer" target="_blank" rel="external">auto prefixing</a>), as well as all JavaScript and image optimization.</p>
<h2 id="Scaffolding-out-the-tasks"><a href="#Scaffolding-out-the-tasks" class="headerlink" title="Scaffolding out the tasks"></a>Scaffolding out the tasks</h2><p>At this point, it’s time to start scaffolding out exactly what needs to be built on a higher level so development is more focused on just writing some simple tasks rather than trying to determine what needs to be where and how <em>x</em> should be called by <em>y</em>.</p>
<h3 id="Main-utility-tasks"><a href="#Main-utility-tasks" class="headerlink" title="Main utility tasks"></a>Main utility tasks</h3><p>We need some main utility tasks to handle all of the heavy lifting, so they can easily get called by the build tasks. Each one should handle all of the optimizations and subtasks for it’s stated code type, that way the watch task can efficiently rebuild the portion of the code that’s changed and not the entire build process.</p>
<ul>
<li><code>buildJs</code>: Concatenate, lint, and minify all JavaScript</li>
<li><code>buildCss</code>: Take the built CSS, run it through the auto-prefixer, then minify</li>
<li><code>buildJekyll</code>: Utility function/task to run the Jekyll build</li>
<li><code>optimizeImg</code>: Run all images through <a href="https://www.npmjs.com/package/gulp-imagemin" target="_blank" rel="external">gulp-imagemin</a> for optimization</li>
<li><code>browser</code>: Initialize a <a href="http://browsersync.io" target="_blank" rel="external">BrowserSync</a> local server</li>
<li><code>browser:reload</code>: Reload our BrowserSync local server</li>
</ul>
<h3 id="Helper-convenience-tasks"><a href="#Helper-convenience-tasks" class="headerlink" title="Helper/convenience tasks"></a>Helper/convenience tasks</h3><p>Utility tasks out of the way, it would be useful to have some helper tasks that can batch the utility classes so the main build tasks and the watch stream aren’t polluted with tons of individual task calls and complications.</p>
<ul>
<li><code>build:assets</code>: Helper task to build, compile and optimize all site assets<ul>
<li><code>buildJs</code></li>
<li><code>buildCss</code></li>
<li><code>optimizeImg</code></li>
</ul>
</li>
<li><code>build</code>: Run the Jekyll build with the _<em>config.yml</em> file<ul>
<li><code>buildJekyll</code></li>
</ul>
</li>
<li><code>build:prod</code>: Same as <code>build</code>, but with the _<em>config.build.yml</em> file<ul>
<li><code>buildJekyll</code></li>
</ul>
</li>
</ul>
<p>It’s also worth noting that while the <code>build</code> and <code>build:prod</code> tasks may seem redundant, they’re necessary as <code>buildJekyll</code> is more of a utility function rather than a task, and to build using a specific config file requires it to be called as a function. I generally build my gulp tasks out as normal <a href="https://darrenderidder.github.io/talks/ModulePatterns/#/" target="_blank" rel="external">Node.js modules</a> so they can exist independent of each other and be called normally. This is achieved by utilizing the <a href="https://www.npmjs.com/package/gulp-auto-task" target="_blank" rel="external">gulp-auto-task</a> module, an absolute must-use with Gulp.</p>
<h3 id="Main-build-tasks"><a href="#Main-build-tasks" class="headerlink" title="Main build tasks"></a>Main build tasks</h3><p>Now that there are all of the tasks necessary to run builds, there needs to be some main build tasks that utilize our helpers and utilities to automate the entire proces for us.</p>
<ul>
<li><code>serve</code>: Fire up a BrowserSync server, run a full site and asset build then watch for any changes.<ul>
<li><code>browser</code></li>
<li><code>build</code></li>
<li><code>build:assets</code></li>
<li><code>browser:reload</code> (on change)</li>
</ul>
</li>
<li><code>deploy</code>: Run a full site and asset build, using the production config file.<ul>
<li><code>build:prod</code></li>
<li><code>build:assets</code></li>
</ul>
</li>
</ul>
<h2 id="Building-out-the-tasks"><a href="#Building-out-the-tasks" class="headerlink" title="Building out the tasks"></a>Building out the tasks</h2><p>Since the workflows needs are pretty well laid out, the Gulp tasks can efficiently start being developed. I like to start out by scaffolding out the utility tasks/functions then creating the main build process. That way I can get all of my tasks working, then the main build tasks are just quick, batched task or function calls.</p>
<h3 id="Getting-a-testable-Gulpfile-set-up"><a href="#Getting-a-testable-Gulpfile-set-up" class="headerlink" title="Getting a testable Gulpfile set up"></a>Getting a testable Gulpfile set up</h3><p>To make sure the tasks are easy to test, a very basic Gulpfile needs to be in place. Two must-use modules I use all the time and absolutely adore make super quick work of this: <a href="https://www.npmjs.com/package/gulp-auto-task" target="_blank" rel="external">gulp-auto-task</a> which automagically turns standard node modules into gulp tasks, and <a href="https://www.npmjs.com/package/require-dir" target="_blank" rel="external">require-dir</a> which will include all files within the specified folder, removing the possibility of having a giant mess of requires.</p>
<figure class="highlight javascript"><figcaption><span>gulpfile.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp          = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</div><div class="line">    <span class="comment">/** Utils */</span></div><div class="line">    requireDir    = <span class="built_in">require</span>(<span class="string">'require-dir'</span>),</div><div class="line">    gulpAutoTask  = <span class="built_in">require</span>(<span class="string">'gulp-auto-task'</span>),</div><div class="line">    <span class="comment">/** Config */</span></div><div class="line">    paths        = <span class="built_in">require</span>(<span class="string">'./package.json'</span>).paths;</div><div class="line"></div><div class="line"><span class="comment">/** Import Main Tasks */</span></div><div class="line"><span class="comment">// Require modules so they can be called as functions</span></div><div class="line"><span class="keyword">var</span> utils = requireDir(<span class="string">'gulp-tasks'</span>); <span class="comment">// ex. utils.buildJekyll();</span></div><div class="line"><span class="comment">// Automagically set up tasks</span></div><div class="line">gulpAutoTask(<span class="string">'&#123;*,**/*&#125;.js'</span>, &#123;</div><div class="line">  <span class="attr">base</span>: paths.tasks,</div><div class="line">  <span class="attr">gulp</span>: gulp</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Technically, <code>require-dir</code> is not necessary at this stage, but it’s easy enough to include now and it saves having to include it later. With this in place, any <em>*.js</em> files placed within the <em>./gulp-tasks/</em> directory will not only get automatically required into the <code>utils</code> object, but they will also be turned into tasks without any <code>gulp.task</code> declarations. Some benefits to this include tasks becoming true modules, more readable files/file structure and <strong>tasks become reusable</strong>, which is very important for the Jekyll build task.</p>
<p>I’m also including a portion of <em>package.json</em> that I use to hold all of my paths. One quirk to working with tasks that are spread across different files is that globals can very quickly become very repetitive, so to solve this and to stay <strong>DRY</strong> I tossed a a <code>paths</code> object into my <em>package.json</em> file, so I can just require that object directly and keep all of my paths in one place.</p>
<figure class="highlight"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  ...</div><div class="line">  "paths": &#123;</div><div class="line">    "tasks": "gulp-tasks/",</div><div class="line">    "src": "project/",</div><div class="line">    "build": "_dist/",</div><div class="line">    "bower": "bower_components/",</div><div class="line">    "vendor": &#123;</div><div class="line">      "src": "project/js/lib/",</div><div class="line">      "dest": "_dist/js/"</div><div class="line">    &#125;,</div><div class="line">    "js": &#123;</div><div class="line">      "src": "project/js/",</div><div class="line">      "dest": "_dist/js/"</div><div class="line">    &#125;,</div><div class="line">    "sass": &#123;</div><div class="line">      "src": "project/_sass/"</div><div class="line">    &#125;,</div><div class="line">    "css": &#123;</div><div class="line">      "src": "project/css/",</div><div class="line">      "dest": "_dist/css/"</div><div class="line">    &#125;,</div><div class="line">    "img": &#123;</div><div class="line">      "src": "project/img/",</div><div class="line">      "dest": "_dist/img/"</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Utility-Tasks"><a href="#Utility-Tasks" class="headerlink" title="Utility Tasks"></a>Utility Tasks</h3><p>Since the Gulpfile is ready to accept tasks in the form of modules, the utility tasks can begin to take shape. As the modules are added they’ll automatically be available to test via <code>gulp &lt;fileName&gt;</code>, which is extremely helpful from a testing standpoint. For the sake of progress, I like to start with the easiest ones to get them knocked out first and foremost; in this case that’s the asset utilities as they are extremely simple and straight forward gulp tasks.</p>
<h4 id="CSS-Build"><a href="#CSS-Build" class="headerlink" title="CSS Build"></a>CSS Build</h4><figure class="highlight javascript"><figcaption><span>gulp-tasks/buildCss.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp        = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</div><div class="line">    <span class="comment">/** Utilities */</span></div><div class="line">    rename      = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>),</div><div class="line">    size        = <span class="built_in">require</span>(<span class="string">'gulp-filesize'</span>),</div><div class="line">    <span class="comment">/** CSS */</span></div><div class="line">    sass          = <span class="built_in">require</span>(<span class="string">'gulp-sass'</span>),</div><div class="line">    minifyCss     = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>),</div><div class="line">    autoprefixer  = <span class="built_in">require</span>(<span class="string">'gulp-autoprefixer'</span>),</div><div class="line">    <span class="comment">/** Config */</span></div><div class="line">    paths      = <span class="built_in">require</span>(<span class="string">"../package.json"</span>).paths;</div><div class="line"></div><div class="line"><span class="comment">/** CSS Build */</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">buildCss</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> gulp.src(paths.css.src + <span class="string">'main.scss'</span>)</div><div class="line">    .pipe(sass(&#123;</div><div class="line">      <span class="attr">includePaths</span>: [paths.sass.src] <span class="comment">// Tell Sass where to look for files</span></div><div class="line">    &#125;).on(<span class="string">'error'</span>, sass.logError))</div><div class="line">    .pipe(autoprefixer(&#123;</div><div class="line">      <span class="attr">browsers</span>: [<span class="string">'last 2 versions'</span>]</div><div class="line">    &#125;))</div><div class="line">    .pipe(minifyCss())</div><div class="line">    .pipe(rename(&#123; <span class="attr">extname</span>: <span class="string">'.min.css'</span> &#125;))</div><div class="line">    .pipe(size()) <span class="comment">// Logs the minified file size to the console</span></div><div class="line">    .pipe(gulp.dest(paths.css.dest));</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>The CSS task is a pretty straightforward, so there’s not too much in it that’s very special. There are two quirks that should be noted:</p>
<ul>
<li>Pass the path to the _<em>sass/</em> folder to the compiler so Sass knows where to look for files that get imported via <code>import();</code> (line 16)</li>
<li>Surrender the handling of styles completely from Jekyll to avoid Sass compilation errors.</li>
</ul>
<p>The former is easy enough and handled within our <code>sass()</code> function, but the latter requires messing with a couple more files.</p>
<ul>
<li><p>Tell Jekyll to exclude the <em>css/</em> directory by adding it to the excludes array within the _<em>config.yml</em> file:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">exclude:</span> [css/]</div></pre></td></tr></table></figure>
</li>
<li><p>Remove the YAML front matter from the <em>main.scss</em> file:</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">// ---</span></div><div class="line"><span class="comment">// # Only the main Sass file needs front matter (the dashes are enough)</span></div><div class="line"><span class="comment">// ---</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="JavaScript-Build"><a href="#JavaScript-Build" class="headerlink" title="JavaScript Build"></a>JavaScript Build</h4><p>Again, there isn’t really anything super special about the JavaSript build that differs from any other run-of-the-mill Gulp JavaScript builds. I gather the vendor files from my <em>js/lib</em> directory and compile them to their own file, then similarly concatenate the regular <em>js/*.js</em> files and build them together. Since Jekyll doesn’t provide much in terms of JavaScript support out of the box, there’s no extra configuration required.</p>
<figure class="highlight javascript"><figcaption><span>gulp-tasks/buildJs.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp        = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</div><div class="line">  <span class="comment">/** Utilities */</span></div><div class="line">    rename      = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>),</div><div class="line">    size        = <span class="built_in">require</span>(<span class="string">'gulp-filesize'</span>),</div><div class="line">  <span class="comment">/** JS Specific */</span></div><div class="line">    jshint      = <span class="built_in">require</span>(<span class="string">'gulp-jshint'</span>),</div><div class="line">    concat      = <span class="built_in">require</span>(<span class="string">'gulp-concat'</span>),</div><div class="line">    uglify      = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>),</div><div class="line"><span class="comment">/** Config */</span></div><div class="line">    paths      = <span class="built_in">require</span>(<span class="string">'../package.json'</span>).paths;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * JavaScript</div><div class="line"> * @todo Extract this to be more dynamic, helper function, specify path, file name, and what tasks to execute.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">buildJs</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// Build vendor files</span></div><div class="line">  gulp.src(paths.vendor.src + <span class="string">'*.js'</span>)</div><div class="line">  <span class="comment">// Concat files</span></div><div class="line">    .pipe(concat(<span class="string">'vendor.js'</span>))</div><div class="line">  <span class="comment">// Minify combined files and rename</span></div><div class="line">    .pipe(uglify())</div><div class="line">    .pipe(rename(&#123; <span class="attr">extname</span>: <span class="string">'.min.js'</span> &#125;))</div><div class="line">    .pipe(size())</div><div class="line">    .pipe(gulp.dest(paths.vendor.dest));</div><div class="line"></div><div class="line">  <span class="keyword">return</span> gulp.src(paths.js.src + <span class="string">'*.js'</span>)</div><div class="line">  <span class="comment">// Concat files</span></div><div class="line">    .pipe(concat(<span class="string">'main.js'</span>))</div><div class="line">  <span class="comment">// Lint file</span></div><div class="line">    .pipe(jshint())</div><div class="line">    .pipe(jshint.reporter(<span class="string">'default'</span>))</div><div class="line">  <span class="comment">// Minify files and rename</span></div><div class="line">    .pipe(uglify())</div><div class="line">    .pipe(rename(&#123; <span class="attr">extname</span>: <span class="string">'.min.js'</span> &#125;))</div><div class="line">    .pipe(size())</div><div class="line">    .pipe(gulp.dest(paths.js.dest));</div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Image-Optimization"><a href="#Image-Optimization" class="headerlink" title="Image Optimization"></a>Image Optimization</h4><p>After having discovered the importance of image optimization while working at a marketing firm and embarking on a giant performance optimization crusade, I try to include it in all of my projects. Luckily, basic image optimization with gulp is a cake walk with <a href="https://www.npmjs.com/package/gulp-imagemin" target="_blank" rel="external">gulp-imagemin</a>.</p>
<figure class="highlight javascript"><figcaption><span>gulp-tasks/optimizeImg.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp        = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</div><div class="line">    <span class="comment">/** Images */</span></div><div class="line">    imagemin    = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>),</div><div class="line">    pngquant    = <span class="built_in">require</span>(<span class="string">'imagemin-pngquant'</span>),</div><div class="line">    <span class="comment">/** Config */</span></div><div class="line">    paths      = <span class="built_in">require</span>(<span class="string">"../package.json"</span>).paths;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Images</div><div class="line"> * @todo Determine better way of handling the inline SVG's so they can get optimized as well.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">optimizeImg</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> gulp.src([paths.img.src + <span class="string">'*'</span>, paths.img.src + <span class="string">'**/*'</span>])</div><div class="line">    .pipe(imagemin(&#123;</div><div class="line">      <span class="attr">progressive</span>: <span class="literal">true</span>,</div><div class="line">      <span class="attr">use</span>: [pngquant(&#123;</div><div class="line">        <span class="attr">quality</span>: <span class="string">'65-75'</span></div><div class="line">      &#125;)]</div><div class="line">    &#125;))</div><div class="line">    .pipe(gulp.dest(paths.img.dest));</div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>At this point I’m pretty happy with the results of the implementation on this site, however as noted in my @todo below I need to determine a better way of handling inline SVG’s, which I currently have as includes. One option I’ve been considering is tossing all of my SVG’s into <strong>assets/svg_, then updating this task to minify and optimize all SVG’s within that folder and toss them into my </strong>includes/svg_ folder so they can easily be inlined via <code>{% include svg/icon-name.svg %}</code>.</p>
<h4 id="Jekyll-Build"><a href="#Jekyll-Build" class="headerlink" title="Jekyll Build"></a>Jekyll Build</h4><p>While the Jekyll build is the real meat and potatoes of the workflow, it’s relatively simple and can be handled using one of two <a href="https://nodejs.org/api/child_process.html" target="_blank" rel="external">child_process</a> methods: <a href="https://nodejs.org/api/child_process.html#child_process_child_process_spawn_command_args_options" target="_blank" rel="external">child_process.spawn</a> or <a href="https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback" target="_blank" rel="external">child_process.exec</a>.</p>
<p>Spawn and exec both do the same thing, but in different ways: spawn returns a stream, is asynchronously asynchronous and meant for streaming large amounts of data back to node, while exec returns a buffer and is synchronously asynchronous and meant for returning small data such as status messages. While both work, I personally prefer and am currently using exec for handling Jekyll builds.</p>
<p><strong>Jekyll Build using <code>child_process.exec</code></strong><br><figure class="highlight javascript"><figcaption><span>gulp-tasks/buildJekyll.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> exec          = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec,</div><div class="line">    <span class="comment">/** Utilities */</span></div><div class="line">    gutil         = <span class="built_in">require</span>(<span class="string">'gulp-util'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Gulp tasks get passed a callback first, so our secondary arg</span></div><div class="line"><span class="comment">// MUST be the second arg. Successful processes return callback(null).</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">buildJekyll</span>(<span class="params">callback, env</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> cmd = <span class="string">'jekyll build --config '</span>;</div><div class="line">  cmd += (env === <span class="string">'prod'</span> ? <span class="string">'_config.build.yml'</span> : <span class="string">'_config.yml'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback</span></div><div class="line">  <span class="keyword">return</span> exec(cmd, <span class="function"><span class="keyword">function</span>(<span class="params">error, stdout, stderror</span>) </span>&#123;</div><div class="line">    gutil.log(stdout); <span class="comment">// Log the output to the console</span></div><div class="line">    <span class="keyword">return</span> callback(error !== <span class="literal">null</span> ? <span class="string">'ERROR: Jekyll process exited with code: '</span>+error.code : <span class="literal">null</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><strong>Jekyll Build using <code>child_process.spawn</code></strong><br><figure class="highlight javascript"><figcaption><span>gulp-tasks/buildJekyll.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** gulp-tasks/buildJekyll.js */</span></div><div class="line"><span class="keyword">var</span> spawn         = <span class="built_in">require</span>(<span class="string">'child_process'</span>).spawn;</div><div class="line"></div><div class="line"><span class="comment">// Gulp tasks get passed a callback first, so our secondary arg</span></div><div class="line"><span class="comment">// MUST be the second arg. Successful processes return callback(null).</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">buildJekyll</span>(<span class="params">callback, env</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> opts = [<span class="string">'build'</span>, <span class="string">'--config'</span>]; <span class="comment">// add base opts</span></div><div class="line"></div><div class="line">  <span class="comment">// if `env` is 'prod', use the production config file</span></div><div class="line">  opts.push(env === <span class="string">'prod'</span> ? <span class="string">'_config.build.yml'</span> : <span class="string">'_config.yml'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Init the `jekyll` command with our `opts` array</span></div><div class="line">  <span class="keyword">var</span> jekyll = spawn(<span class="string">'jekyll'</span>, opts, &#123;</div><div class="line">  <span class="comment">// https://nodejs.org/api/child_process.html#child_process_options_stdio</span></div><div class="line">    stdio: <span class="string">'inherit'</span> <span class="comment">// use stdin, stdout, etc.</span></div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// Once finished, fire the Gulp callback</span></div><div class="line">  <span class="keyword">return</span> jekyll.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> callback(code === <span class="number">0</span> ? <span class="literal">null</span> : <span class="string">'ERROR: Jekyll process exited with code: '</span>+code);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>Having used both spawn and exec, I personally prefer exec due to the cleanliness and compactness of the resulting file and I’ve noticed better consistency with how quick the process has been ending, allowing the following queued tasks to start quicker.</p>
<h3 id="Helper-and-Convenience-Tasks"><a href="#Helper-and-Convenience-Tasks" class="headerlink" title="Helper and Convenience Tasks"></a>Helper and Convenience Tasks</h3><p>With the utility tasks completed, the entire workflow could be emulated by manually running each task individually. As I don’t think anyone is really interested in a workflow that would require you to manually run each task individually, some helper tasks are definitely in order to automate everything. These tasks can then be called either individually or by the main build tasks, keeping our main build tasks concise.</p>
<p>Since these helper tasks are pretty much exclusively batch task runners, they can just get tossed into the Gulpfile after the task importation.</p>
<figure class="highlight javascript"><figcaption><span>gulpfile.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** Helper Tasks */</span></div><div class="line">gulp.task(<span class="string">'build'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> utils.buildJekyll(callback, <span class="string">'serve'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'build:prod'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> utils.buildJekyll(callback, <span class="string">'prod'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'build:assets'</span>, [<span class="string">'buildCss'</span>, <span class="string">'buildJs'</span>, <span class="string">'optimizeImg'</span>]);</div></pre></td></tr></table></figure>
<p>On lines 2 - 4 the <code>build</code> task is getting declared, which just returns the <code>buildJekyll</code> utility function with the Gulp callback and non-<code>prod</code> environment passed in. On 6 - 8 the same is being done for the <code>build:prod</code> task but with the <code>prod</code> environment passed in as the second argument to dictate the use of the production build file. This duplication is a bummer, but it’s unfortunately necessary so the environment can get passed in. Since the <code>buildJekyll</code> call is being returned and the completed buffer returns by calling the Gulp callback, the task is also able to be used in sequence which is very important while making the main build tasks.</p>
<p>On line 9 the <code>build:assets</code> call isn’t anything super special, it’s just a simple Gulp task that is calling all of our asset build tasks. This isn’t super necessary but it’s nice being able to call just one task rather than three whenever a full asset build needs to be run.</p>
<h3 id="Implementing-BrowserSync"><a href="#Implementing-BrowserSync" class="headerlink" title="Implementing BrowserSync"></a>Implementing BrowserSync</h3><p>Since the entire build system is being handle by Gulp, it makes sense to have Gulp handle the local server as well. Rather than somehow hacking the the <code>jekyll serve</code> command into our watch command, tossing the blame to Gulp requires a lot less legwork; especially when integrating something like <a href="http://browsersync.io" target="_blank" rel="external">BrowserSync</a>, which is my personal favorite. Not only is BrowserSync super easy to set up but it has some super cool features such as device syncing (which is incredibly fun to play with).</p>
<p>While the tasks being so small is reason enough to toss them into the Gulpfile after our helpers, the initialization of the server and the reload task need to be within the same file for them to know each other exist, making throwing these into the Gulpfile a necessity.</p>
<figure class="highlight javascript"><figcaption><span>gulpfile.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// BrowserSync needs to get required at the top of the file</span></div><div class="line"><span class="keyword">var</span> browserSync   = <span class="built_in">require</span>(<span class="string">'browser-sync'</span>).create(<span class="string">'jekyll'</span>);</div><div class="line"></div><div class="line">. . .</div><div class="line"></div><div class="line"><span class="comment">/** BrowserSync */</span></div><div class="line"><span class="comment">// Init server to build directory</span></div><div class="line">gulp.task(<span class="string">'browser'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  browserSync.init(&#123;</div><div class="line">    <span class="attr">server</span>: <span class="string">"./"</span> + paths.build,</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Force reload across all devices</span></div><div class="line">gulp.task(<span class="string">'browser:reload'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  browserSync.reload();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Luckily BrowserSync is super easy to implement, so there isn’t a whole lot of bloat added to the Gulpfile. The module gets required and the server gets created with the name <em>Jekyll</em>, then the <code>browser</code> task actually initializes the server using the build path specified in the <em>package.json</em> file and finally the <code>browser:reload</code> task takes the initialized server and sends it a notice to refresh. Piece of cake.</p>
<h3 id="Creating-the-Main-Build-tasks"><a href="#Creating-the-Main-Build-tasks" class="headerlink" title="Creating the Main Build tasks"></a>Creating the Main Build tasks</h3><p>So far all of the tasks required to actually fully build the site are completely scaffolded out, and the build could actually be used by manually running <code>gulp build &amp;&amp; gulp build:assets</code> in the command line. That’s all great, but personally I would find that super annoying, plus it wouldn’t turn on the BrowserSync server. Since the whole point of this is complete automation, some build tasks are in order.</p>
<figure class="highlight javascript"><figcaption><span>gulpfile.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> watch         = <span class="built_in">require</span>(<span class="string">'gulp-watch'</span>),</div><div class="line">    runSequence   = <span class="built_in">require</span>(<span class="string">'run-sequence'</span>);</div><div class="line"></div><div class="line">. . .</div><div class="line"></div><div class="line"><span class="comment">/** Main Builds */</span></div><div class="line">gulp.task(<span class="string">'serve'</span>, [<span class="string">'browser'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  runSequence(<span class="string">'build'</span>, [<span class="string">'build:assets'</span>]);</div><div class="line">  <span class="comment">// CSS/SCSS</span></div><div class="line">  watch([</div><div class="line">        paths.src +<span class="string">'fonts/*'</span>,</div><div class="line">        paths.sass.src +<span class="string">'*.scss'</span>,</div><div class="line">        paths.css.src +<span class="string">'main.scss'</span>,</div><div class="line">        paths.sass.src +<span class="string">'**/*.scss'</span>,</div><div class="line">  ], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    runSequence(<span class="string">'buildCss'</span>, [<span class="string">'browser:reload'</span>]);</div><div class="line">  &#125;);</div><div class="line">  <span class="comment">// JS</span></div><div class="line">  watch([paths.js.src +<span class="string">'*.js'</span>, paths.vendor.src +<span class="string">'*.js'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    runSequence(<span class="string">'buildJs'</span>, [<span class="string">'browser:reload'</span>]);</div><div class="line">  &#125;);</div><div class="line">  <span class="comment">// Images</span></div><div class="line">  watch([paths.img.src +<span class="string">'*'</span>, paths.img.src +<span class="string">'**/*'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    runSequence(<span class="string">'optimizeImg'</span>, [<span class="string">'browser:reload'</span>]);</div><div class="line">  &#125;);</div><div class="line">  <span class="comment">// Markup / Posts/ Data</span></div><div class="line">  watch([</div><div class="line">        paths.src +<span class="string">'*'</span>,</div><div class="line">        paths.src +<span class="string">'_data/*'</span>,</div><div class="line">        paths.src +<span class="string">'_plugins/*'</span>,</div><div class="line">        paths.src +<span class="string">'**/*.md'</span>,</div><div class="line">        paths.src +<span class="string">'**/*.html'</span>,</div><div class="line">        paths.src +<span class="string">'**/*.markdown'</span>,</div><div class="line">        paths.src +<span class="string">'_includes/**/*.md'</span>,</div><div class="line">        paths.src +<span class="string">'_includes/**/*.svg'</span>,</div><div class="line">        paths.src +<span class="string">'_includes/**/*.html'</span>,</div><div class="line">  ], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    runSequence(<span class="string">'build'</span>, [<span class="string">'build:assets'</span>, <span class="string">'browser:reload'</span>]);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  gutil.log(<span class="string">'Watching for changes.'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'deploy'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  runSequence(<span class="string">'build:prod'</span>, [<span class="string">'build:assets'</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>The <code>gulp deploy</code> task (lines 44 - 46) is nothing special, so I won’t really get into that as it’s essentially that I mentioned in the first part of this section, just a batch task. The <code>gulp serve</code> task (lines 7 - 42) however looks like quite the stinker, especially due to my use of the <a href="https://www.npmjs.com/package/gulp-watch" target="_blank" rel="external">gulp-watch</a> module rather than the built in <code>gulp.watch</code> function; the former taking an endless stream approach, which I prefer.</p>
<h4 id="The-gulp-serve-task-explained"><a href="#The-gulp-serve-task-explained" class="headerlink" title="The gulp serve task, explained"></a>The <code>gulp serve</code> task, explained</h4><p>While the task looks like an absolute monster, it’s actually pretty simple. On a very high level, it just sets up some listeners for each type of file that should trigger some sort of rebuild, and is broken down by type:</p>
<ul>
<li>CSS/Sass files which should trigger a style rebuild</li>
<li>JavaScript files which should trigger a JS rebuild</li>
<li>Images which should trigger image re-optimization</li>
<li>Anything else which should trigger a full rebuild due to the Jekyll build cleaning the destination folder</li>
</ul>
<p>As I said, pretty simple but there’s one other quirk to the build that will almost certainly need a refactor with the release of Gulp 4 that I haven’t explained yet, which is the <a href="https://www.npmjs.com/package/run-sequence" target="_blank" rel="external"><code>runSequence</code> module</a> that keeps getting called. Obviously there’s a very specific order that needs to be called each time; if the other tasks fire and complete before the Jekyll build is complete, they’ll be deleted by the Jekyll build and made pointless. This could be solved by adding some of the assets folders to the <code>excludes</code> within the _<em>config.yml</em> file, but I’d rather not have to toss in extra cleans in all of the builds and worry about extra artifacts sticking around and bloating up the built site.</p>
<p>RunSequence effectively forces tasks to run in sequence, so the queued tasks will not run until the first task is completed. This is why in all of the utility tasks the stream / callback is always getting returned, giving runSequence a reference of when one task ends so it can call the next task.</p>
<h2 id="To-do"><a href="#To-do" class="headerlink" title="To-do"></a>To-do</h2><p>Using runSequence to force things to run in order is a little bit of a hacky solution (it’s even mentioned as a hack within the readme for the module) until <a href="https://github.com/orchestrator/orchestrator" target="_blank" rel="external">orchestrator</a>, what Gulp is built off of, is updated to support <a href="https://github.com/orchestrator/orchestrator/issues/21" target="_blank" rel="external">non-dependent ordered tasks</a>. This is supposed to make it into <a href="https://github.com/gulpjs/gulp/milestones" target="_blank" rel="external">Gulp 4</a>, so once that’s released I will definitely be refactoring this to be less hacky.</p>
<div class="bg-video-wrap" style="background-image: url('/img/videos/gulpVid.png');"><br>  <video class="bg-video-player" autoplay loop><br>    <source src="/img/videos/gulpVid.mp4" type="video/mp4; codecs=avc1.42E01E,mp4a.40.2"><br>    <source src="/img/videos/gulpVid.webm" type="video/webm; codecs=vp8,vorbis"><br>    <source src="/img/videos/gulpVid.ogv" type="video/ogg; codecs=theora,vorbis"><br>  </video><br></div>

<h2 id="The-Completed-Workflow"><a href="#The-Completed-Workflow" class="headerlink" title="The Completed Workflow"></a>The Completed Workflow</h2><p>With everything built, development is started by running <code>gulp serve</code>, which spins up a BrowserSync server and does a full Jekyll and asset build, then watches for any changes and automagically runs whatever builds are necessary to quickly reflect that change on the BrowserSync server. Once development is finished and something is ready to be deployed, <code>gulp deploy</code> can be run to run a full Jekyll and asset build, but using the _<em>config.build.yml</em> config file to get the correct URLs and build settings for production. This task only gets run by my server after I’ve pushed up a new commit to it, which I’ll cover in a blog post later although there are many posts already in reference to this (such as <a href="https://www.digitalocean.com/community/tutorials/how-to-deploy-jekyll-blogs-with-git" target="_blank" rel="external">this one</a> on <a href="digitalocean.com">Digital Ocean</a>).</p>
<p>You can find all of the completed files referenced in this post in the <a href="https://github.com/aesinv/aesinv-jekyll-blog/" target="_blank" rel="external">GitHub repository</a> for this site.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://aesinv.com/development/building-a-gulp-workflow-around-jekyll/" data-id="cizy4qye00001ahpgxwqgmsof" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gulp/">gulp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jekyll/">jekyll</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/workflow/">workflow</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/development/making-a-js-game-part-1-game-engine/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Building a simple JavaScript game - 1. A basic game engine
        
      </div>
    </a>
  
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">development</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/game-dev/">game dev</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Internet-of-Things/">Internet of Things</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IoT/">IoT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adobe-cq/">adobe cq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aem/">aem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aem6/">aem6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/beacons/">beacons</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-along/">code along</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crying-yourself-to-sleep/">crying yourself to sleep</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/device-motion/">device motion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dungeon-crawler/">dungeon crawler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/experimental-tech/">experimental tech</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/game-development/">game development</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-issues/">git issues</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gulp/">gulp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ibeacon/">ibeacon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jekyll/">jekyll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sass/">sass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sightly/">sightly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unity/">unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utilities/">utilities</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/workflow/">workflow</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Internet-of-Things/" style="font-size: 10px;">Internet of Things</a> <a href="/tags/IoT/" style="font-size: 10px;">IoT</a> <a href="/tags/adobe-cq/" style="font-size: 15px;">adobe cq</a> <a href="/tags/aem/" style="font-size: 10px;">aem</a> <a href="/tags/aem6/" style="font-size: 10px;">aem6</a> <a href="/tags/beacons/" style="font-size: 10px;">beacons</a> <a href="/tags/code-along/" style="font-size: 10px;">code along</a> <a href="/tags/crying-yourself-to-sleep/" style="font-size: 10px;">crying yourself to sleep</a> <a href="/tags/device-motion/" style="font-size: 10px;">device motion</a> <a href="/tags/dungeon-crawler/" style="font-size: 10px;">dungeon crawler</a> <a href="/tags/experimental-tech/" style="font-size: 10px;">experimental tech</a> <a href="/tags/game-development/" style="font-size: 15px;">game development</a> <a href="/tags/games/" style="font-size: 10px;">games</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/git-issues/" style="font-size: 10px;">git issues</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/gulp/" style="font-size: 15px;">gulp</a> <a href="/tags/ibeacon/" style="font-size: 10px;">ibeacon</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/sass/" style="font-size: 10px;">sass</a> <a href="/tags/sightly/" style="font-size: 10px;">sightly</a> <a href="/tags/unity/" style="font-size: 10px;">unity</a> <a href="/tags/utilities/" style="font-size: 10px;">utilities</a> <a href="/tags/workflow/" style="font-size: 10px;">workflow</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/uncategorized/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/development/fixing-git-push-pull-timeout/">Fixing git push/pull timing out</a>
          </li>
        
          <li>
            <a href="/development/passing-data-from-aem6-to-javascript/">Different ways to pass data from AEM6 to Javascript</a>
          </li>
        
          <li>
            <a href="/development/simplified-aem-frontend-sass/">A simplified front end architecture solution for AEM</a>
          </li>
        
          <li>
            <a href="/game-dev/keeping-the-user-entertained-when-they-fail/">Game Dev Log: Keeping the player entertained when they fail</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Matt Bengston<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>