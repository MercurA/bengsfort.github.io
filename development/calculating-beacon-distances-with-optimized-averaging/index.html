<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Calculating iBeacon distances with optimized averaging | Code &amp; Stuff</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="It’s no real secret that beacons are most certainly still an “emerging technology” with some growing pains. Unfortunately when you’re working on a hybrid app that depends on them, you kind of have to">
<meta property="og:type" content="article">
<meta property="og:title" content="Calculating iBeacon distances with optimized averaging">
<meta property="og:url" content="http://aesinv.com/development/calculating-beacon-distances-with-optimized-averaging/index.html">
<meta property="og:site_name" content="Code & Stuff">
<meta property="og:description" content="It’s no real secret that beacons are most certainly still an “emerging technology” with some growing pains. Unfortunately when you’re working on a hybrid app that depends on them, you kind of have to">
<meta property="og:updated_time" content="2017-03-06T13:39:13.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Calculating iBeacon distances with optimized averaging">
<meta name="twitter:description" content="It’s no real secret that beacons are most certainly still an “emerging technology” with some growing pains. Unfortunately when you’re working on a hybrid app that depends on them, you kind of have to">
  
    <link rel="alternate" href="/atom.xml" title="Code &amp; Stuff" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Code &amp; Stuff</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://aesinv.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-calculating-beacon-distances-with-optimized-averaging" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/development/calculating-beacon-distances-with-optimized-averaging/" class="article-date">
  <time datetime="2015-12-29T09:30:48.000Z" itemprop="datePublished">29 December, 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/development/">development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Calculating iBeacon distances with optimized averaging
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>It’s no real secret that beacons are most certainly still an “emerging technology” with some growing pains. Unfortunately when you’re working on a hybrid app that depends on them, you kind of have to figure out a way to make things work. In this instance, it’s trying to weed-out the distance/signal strength inconsistencies so user location can be calculated correctly and accurately. </p>
<h2 id="The-problem"><a href="#The-problem" class="headerlink" title="The problem"></a>The problem</h2><p>When you’re detecting your beacons via an app that’s listening for them (using the <a href="https://github.com/petermetz/cordova-plugin-ibeacon" target="_blank" rel="external">Proximity Beacon Plugin</a> for <a href="https://cordova.apache.org/" target="_blank" rel="external">Cordova</a>/<a href="http://ionicframework.com/" target="_blank" rel="external">Ionic</a>, for example) you receive a constant bombardment of objects representing that beacon that you can do with as you please, including an estimated distance <em>(referred to as Accuracy)</em>. Here’s an example object you could expect to see back:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Example beacon object</span></div><div class="line">&#123;</div><div class="line">    <span class="attr">proximity</span>: <span class="string">'ProximityNear'</span>,</div><div class="line">    <span class="attr">accuracy</span>: <span class="number">3.39</span>,</div><div class="line">    <span class="attr">uuid</span>: <span class="string">'140b70ed-cfb3-418g-8611-4dcd06d2d63d'</span>,</div><div class="line">    <span class="attr">major</span>: <span class="number">7</span>,</div><div class="line">    <span class="attr">minor</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">rssi</span>: <span class="number">50</span>,</div><div class="line">    <span class="attr">tx</span>: <span class="number">1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now, when I say you get bombarded by these objects I mean it. To circumvent this and spare the users phone my team and I have a throttling service that only allows us to submit the beacon data for location calculation every 3 seconds or so, however we noticed a major issue crop up every so often which involved our distance (accuracy, line 4) being incredibly inaccurate. We’re talking upwards of 4 meters off from where we knew we were standing, which when the end result gets compared to a set of boundaries to determine whether or not the device is in a specified zone is a pretty big deal.</p>
<p>After lots of research and lots of data logging, we discovered two things:</p>
<ol>
<li>On average the distance reported by the beacon is somewhat consistent, however the pool of reported distances gets polluted by plenty hilariously inaccurate distances.</li>
<li>Since we were not taking an average of our collection of distances, the distance that would get submitted for calculation was the last distance received before the timeout was finished; basically Beacon Distance Roulette. </li>
</ol>
<p>Number 2 isn’t too big of an issue as it just involves storing beacon data in beacon-unique arrays then calculating the average of the stored distances for each array, which if the distances are stored as an array would be an extremely simple procedure:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Example averaging of a beacon array</span></div><div class="line"><span class="keyword">var</span> averages = [];</div><div class="line"></div><div class="line"><span class="comment">// Iterate through beacons</span></div><div class="line"><span class="keyword">for</span> (key <span class="keyword">in</span> beacons) &#123;</div><div class="line">  <span class="comment">// beacons[key] = [5.27, 6.07, 5.45, 5.05, 4.04, 4.37, 4.55]</span></div><div class="line">  averages[key] = beacons[key].reduce(<span class="function"><span class="keyword">function</span> (<span class="params">prev, cur</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> prev + cur;</div><div class="line">  &#125;) / arr.length; <span class="comment">// 4.97</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// submit `averages` for calculation</span></div></pre></td></tr></table></figure>
<p>So that leaves us with tricky number 1, which would fall short when it comes to regular averaging if there were enough inaccurate distances; therefore requiring a more intricate solution. </p>
<h2 id="The-solution"><a href="#The-solution" class="headerlink" title="The solution"></a>The solution</h2><p>My first solution was to average the list twice, the first time being used to create a middle point to calculate the data pool for the second average. This however proved to be inaccurate as the distance inconsistencies grew farther apart. </p>
<p>The solution I decided to go with was to create a simple utility that would iterate through the array of numbers, tally up how many times each whole number appeared within the array, then use along with a buffer to establish boundaries that I could use to ignore unreliable data. Coupled with the throttling, this turned out to be exactly the solution we were looking for/</p>
<p>I first decided to scaffold out the utility so I could get an idea of exactly what it was it would need to do. This is generally where I start with everything that I make, as I just find it easier to go through at a high level then start to dive in deeper where necessary.</p>
<figure class="highlight javascript"><figcaption><span>optimizedAverages.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Optimized Average calculation</div><div class="line"> * Takes an array of numbers, then throws away unreliable numbers</div><div class="line"> * to get a more precise average.</div><div class="line"> *</div><div class="line"> * @param &#123;number[]&#125; Numbers - Array of numbers to optimize.</div><div class="line"> * @returns &#123;number&#125; - The optimized average, rounded to the nearest hundredth.</div><div class="line"> */ </div><div class="line"><span class="keyword">var</span> optimizedAverage = <span class="function"><span class="keyword">function</span> <span class="title">optimizeDistanceAverage</span>(<span class="params"> Numbers </span>) </span>&#123;</div><div class="line">  <span class="comment">// Tally up the amount of times a whole number occurs in the array</span></div><div class="line">  <span class="keyword">var</span> countNums;</div><div class="line">  </div><div class="line">  <span class="comment">// determine the most probable distance from the tally (the number that appears the most)</span></div><div class="line">  <span class="keyword">var</span> mostReliable;</div><div class="line"></div><div class="line">  <span class="comment">/** </span></div><div class="line">   * Get the average of the provided numbers that are:</div><div class="line">   *  1. Less than double the most reliable number,</div><div class="line">   *  2. More than half the most reliable number,</div><div class="line">   *  then round it to the nearest hundredth.</div><div class="line">   */</div><div class="line">   <span class="keyword">var</span> average;</div><div class="line">   <span class="keyword">return</span> average;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// Expose Utility to whatever needs it</span></div><div class="line"><span class="keyword">if</span> ( <span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">"object"</span> &amp;&amp; <span class="built_in">module</span>.exports ) <span class="built_in">module</span>.exports = optimizedAverage;</div><div class="line"><span class="keyword">if</span> ( <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">"undefined"</span> ) <span class="built_in">window</span>.optimizedAverage = optimizedAverage;</div></pre></td></tr></table></figure>
<p>Let’s start by writing some helpers that will come in handy for the rest, like an averaging function as well as a rounding function.</p>
<figure class="highlight javascript"><figcaption><span>optimizedAverages.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">. . .</div><div class="line">var optimizedAverage = <span class="function"><span class="keyword">function</span> <span class="title">optimizeDistanceAverage</span>(<span class="params"> Numbers </span>) </span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Get the average from an array of numbers</div><div class="line">   * @param &#123;number[]&#125; arr - Array of numbers to average</div><div class="line">   * @returns &#123;number&#125; - The average of the numbers.</div><div class="line">   */</div><div class="line">  <span class="keyword">var</span> getAverage = <span class="function"><span class="keyword">function</span> <span class="title">getAverage</span>(<span class="params"> arr </span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> arr.reduce( <span class="function"><span class="keyword">function</span> <span class="title">reduceGetAverage</span>(<span class="params"> prev, cur </span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> prev + cur;</div><div class="line">    &#125;) / arr.length;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Round a number to the nearest hundredth</div><div class="line">   * @param &#123;number&#125; num - the number to round</div><div class="line">   * @returns &#123;number&#125; - the rounded result</div><div class="line">   */</div><div class="line">  <span class="keyword">var</span> roundResult = <span class="function"><span class="keyword">function</span> <span class="title">roundResult</span>(<span class="params"> num </span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> ( <span class="built_in">Math</span>.round( num * <span class="number">100</span> ) / <span class="number">100</span> ).toFixed( <span class="number">2</span> );</div><div class="line">  &#125;;</div><div class="line">  . . .</div><div class="line">&#125;;</div><div class="line">. . .</div></pre></td></tr></table></figure>
<p>The averaging function (<code>getAverage()</code>, <em>lines 7 - 11</em>) is essentially the same as the block shown in the last section that averaged the array, so nothing new there. The rounding function (<code>roundResult()</code>, <em>lines 18 - 20</em>) isn’t anything too special either, they’re just some math calculations that would be extremely annoying to write more than once.</p>
<p>From there we can start getting into the real meat-and-potatoes of the utility, namely the function that iterates through the distance array and tallies up how popular each whole number is. Since it’s JavaScript and this involves iterating through an array, there are obviously 8 million and four ways to write it however on this occasion I’m feeling the humble <code>for(;;) {}</code> loop, particularly because I’ve got to be able to declare keys to properly track each number.</p>
<figure class="highlight javascript"><figcaption><span>optimizedAverages.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Tallies up the amount of times a whole number occurs in the array.</div><div class="line"> * @param &#123;number[]&#125; numbers - Array of numbers to iterate over.</div><div class="line"> * @returns &#123;object&#125; - Returns the completed tally object.</div><div class="line"> */</div><div class="line"><span class="keyword">var</span> countNums = <span class="function"><span class="keyword">function</span> <span class="title">countNums</span>(<span class="params"> numbers </span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> count = [];</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; numbers.length; ++i) &#123;</div><div class="line">    <span class="comment">// Cache the whole number</span></div><div class="line">    <span class="keyword">var</span> floored = <span class="built_in">Math</span>.floor( numbers[i] );</div><div class="line">    <span class="comment">// Check to see if we've already stored the number</span></div><div class="line">    <span class="keyword">if</span> ( !count.hasOwnProperty( floored ) ) &#123;</div><div class="line">      count[floored] = <span class="number">1</span>; <span class="comment">// Start off the numbers tally</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      ++count[floored]; <span class="comment">// Add to the tally</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> count;</div><div class="line">&#125;( Numbers ); <span class="comment">// Self-invoke the function with the `Numbers` array</span></div></pre></td></tr></table></figure>
<p>As for loops go it’s a pretty basic one, but I’ll walk you through what we’re doing just in case:</p>
<ol>
<li>Creating an empty array to hold our number tallies. <em>(line 6)</em></li>
<li>Iterating through the passed in array, storing the active whole number as we go. <em>(lines 8, 10)</em></li>
<li>Checking to see if the number already has a tally, if not we start it off at 1 and if so we increment it by 1. <em>(lines 12 - 16)</em></li>
<li>Returning the array containing our tallies, then self-invoking the function with the array of distances passed into the utility. <em>(lines 19, 20)</em></li>
</ol>
<p>From there we’re on the home stretch, as now we have an array telling us how many times each distance present in the array appears, so we can easily determine the most probable distance and use that to create a buffer zone of distances we’ll still accept for our final average.</p>
<figure class="highlight javascript"><figcaption><span>optimizedAverages.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Determine the most reliable number (the number that appears most)</span></div><div class="line"><span class="keyword">var</span> mostReliable = countNums.reduce(<span class="function"><span class="keyword">function</span> <span class="title">reduceMostReliable</span>(<span class="params">prev, cur, i, arr</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> arr[prev] &gt; cur ? prev : i;</div><div class="line">&#125;, <span class="number">0</span>);</div></pre></td></tr></table></figure>
<p>Since we’re saving our array containing our tally <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank" rel="external">reduce</a> can come to the rescue and <em>reduce</em> our array down to a single, probable distance. This could be done a little bit more readable, but I’ll break down the logic so it’s a little bit easier to understand what’s going on. </p>
<p>The indexes of the array are the whole numbers that we got from our distances, so those are always available to us via <code>i</code>; since reduce provides the last returned value as <code>prev</code>, we can essentially persist the most probably whole number through <code>prev</code>, and still be able to access the amount of times it appeared by pointing the array to that index (<code>arr[prev]</code>). Therefore:</p>
<pre><code>if the current probable number (prev) appeared more times (arr[prev]) than the current value (cur)
   return the current probable number;
   otherwise return the current values index as the new probable number (i)
</code></pre><p>A little bit confusing, I know, but the second it clicks it makes all the sense in the world. As a bonus, it also means we’re one code block away from being done! Lastly we have to get the rounded average of our reliable distances, which are dictated by whether or not they are:</p>
<ol>
<li>Less than double the most probable distance</li>
<li>More than half of the most probable distance</li>
</ol>
<p>There are a couple different ways to write this, so I’ll start with the easy to read version then show the more compact version.</p>
<figure class="highlight javascript"><figcaption><span>optimizedAverages.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** </span></div><div class="line"> * Create a new array with the provided numbers that are:</div><div class="line"> *  1. Less than double the most probable distance,</div><div class="line"> *  2. More than half the most probable distance,</div><div class="line"> */</div><div class="line"><span class="keyword">var</span> reliableList = Numbers.filter(<span class="function"><span class="keyword">function</span>(<span class="params"> num </span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.ceil( num ) &gt; ( mostReliable / <span class="number">2</span> ) <span class="comment">// ceil of the number is greater than half </span></div><div class="line">      &amp;&amp; <span class="built_in">Math</span>.floor( num ) &lt; ( mostReliable * <span class="number">2</span> ); <span class="comment">// floor of the number is less than double</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Get the average of our new array</span></div><div class="line"><span class="keyword">var</span> reliableAverage = getAverage( reliableList );</div><div class="line"><span class="comment">// Return the rounded average</span></div><div class="line"><span class="keyword">return</span> roundResult( reliableAverage );</div></pre></td></tr></table></figure>
<p>Here all we’re doing is filtering through our original list and picking out any numbers that are over or under a certain threshold, that way we can keep our data pool small and accurate and get a better average. I’ve got it set at double and half, as I noticed that was a good buffer when reviewing the range of inconsistency in our data logs. </p>
<p>By setting it at double and half we provide a larger buffer for the higher distances (which have a larger range of inconsistency), and far less wiggle room when we’re closer to the beacon (when the distance will have less inconsistencies); making smaller distances more accurate and farther distances easier to estimate.</p>
<p>Like I said though, this final block can be written a little bit more concise as well:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** </span></div><div class="line"> * Create a new array with the provided numbers that are:</div><div class="line"> *  1. Less than double the most probable distance,</div><div class="line"> *  2. More than half the most probable distance,</div><div class="line"> */</div><div class="line"><span class="keyword">return</span> roundResult( getAverage( Numbers.filter( <span class="function"><span class="keyword">function</span>(<span class="params"> num </span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.ceil( num ) &gt; ( mostReliable / <span class="number">2</span> ) &amp;&amp; <span class="built_in">Math</span>.floor( num ) &lt; ( mostReliable * <span class="number">2</span> );</div><div class="line">&#125;) ) );</div></pre></td></tr></table></figure>
<p>Yummy, what was previously 8 lines is now 3! This is another benefit of us adding our helpers in earlier, instead of having to toss all of those calculations inline we can just call them in our return on the fly after calculating our new reliableList.</p>
<p>After all is said and done piping our distances through this utility should allow us to get far more accurate distance calculations thanks to ignoring unreliable data. Here’s the results from some test runs I ran so you can see what I mean:</p>
<pre><code>Numbers provided: [1.97, 1.74, 1.44, 1.5, 1.47, 1.41, 1.42, 1.22, 1.17, 1.2, 2.15]
Pre-optimized average: 1.52
Numbers discarded: 1
Optimized average: 1.45

Numbers provided: [5.27, 2.25, 2.45, 1.87, 1.89, 2.11, 1.97, 2.06, 1.93, 2.22, 2.22]
Pre-optimized average: 2.39
Numbers discarded: 1
Optimized average: 2.10

Numbers provided: [14.78, 2.25, 2.45, 1.87, 1.89, 2.11, 9.33, 1.97, 2.06, 1.93, 2.22, 2.22, 11.17]
Pre-optimized average: 4.33
Numbers discarded: 3
Optimized average: 2.22
</code></pre><p>You can view the full file <a href="https://github.com/aesinv/optimized-averages/blob/master/optimizedAverages.js" target="_blank" rel="external">on GitHub</a>, with full comments and ready to roll. You can also play around with it on <a href="https://tonicdev.com/npm/optimized-averages" target="_blank" rel="external">Tonic</a>.</p>
<p>Cheers!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://aesinv.com/development/calculating-beacon-distances-with-optimized-averaging/" data-id="cizy4qydx0000ahpgsnoa8ert" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Internet-of-Things/">Internet of Things</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IoT/">IoT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/beacons/">beacons</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ibeacon/">ibeacon</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/utilities/">utilities</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/game-dev/keeping-the-user-entertained-when-they-fail/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Game Dev Log: Keeping the player entertained when they fail
        
      </div>
    </a>
  
  
    <a href="/development/making-a-js-game-part-1-game-engine/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Building a simple JavaScript game - 1. A basic game engine</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">development</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/game-dev/">game dev</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Internet-of-Things/">Internet of Things</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IoT/">IoT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adobe-cq/">adobe cq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aem/">aem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aem6/">aem6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/beacons/">beacons</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-along/">code along</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crying-yourself-to-sleep/">crying yourself to sleep</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/device-motion/">device motion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dungeon-crawler/">dungeon crawler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/experimental-tech/">experimental tech</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/game-development/">game development</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-issues/">git issues</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gulp/">gulp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ibeacon/">ibeacon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jekyll/">jekyll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sass/">sass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sightly/">sightly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unity/">unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utilities/">utilities</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/workflow/">workflow</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Internet-of-Things/" style="font-size: 10px;">Internet of Things</a> <a href="/tags/IoT/" style="font-size: 10px;">IoT</a> <a href="/tags/adobe-cq/" style="font-size: 15px;">adobe cq</a> <a href="/tags/aem/" style="font-size: 10px;">aem</a> <a href="/tags/aem6/" style="font-size: 10px;">aem6</a> <a href="/tags/beacons/" style="font-size: 10px;">beacons</a> <a href="/tags/code-along/" style="font-size: 10px;">code along</a> <a href="/tags/crying-yourself-to-sleep/" style="font-size: 10px;">crying yourself to sleep</a> <a href="/tags/device-motion/" style="font-size: 10px;">device motion</a> <a href="/tags/dungeon-crawler/" style="font-size: 10px;">dungeon crawler</a> <a href="/tags/experimental-tech/" style="font-size: 10px;">experimental tech</a> <a href="/tags/game-development/" style="font-size: 15px;">game development</a> <a href="/tags/games/" style="font-size: 10px;">games</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/git-issues/" style="font-size: 10px;">git issues</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/gulp/" style="font-size: 15px;">gulp</a> <a href="/tags/ibeacon/" style="font-size: 10px;">ibeacon</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/sass/" style="font-size: 10px;">sass</a> <a href="/tags/sightly/" style="font-size: 10px;">sightly</a> <a href="/tags/unity/" style="font-size: 10px;">unity</a> <a href="/tags/utilities/" style="font-size: 10px;">utilities</a> <a href="/tags/workflow/" style="font-size: 10px;">workflow</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/uncategorized/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/development/fixing-git-push-pull-timeout/">Fixing git push/pull timing out</a>
          </li>
        
          <li>
            <a href="/development/passing-data-from-aem6-to-javascript/">Different ways to pass data from AEM6 to Javascript</a>
          </li>
        
          <li>
            <a href="/development/simplified-aem-frontend-sass/">A simplified front end architecture solution for AEM</a>
          </li>
        
          <li>
            <a href="/game-dev/keeping-the-user-entertained-when-they-fail/">Game Dev Log: Keeping the player entertained when they fail</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Matt Bengston<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>