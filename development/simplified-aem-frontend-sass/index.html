<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>A simplified front end architecture solution for AEM | Code &amp; Stuff</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Tl;dr

Simplify your build process using some of AEM’s built-in features.
Use a Maven Sass plugin so you’re not limited to plain-old CSS or forcing back end devs to deal with gulp builds.
Create a sim">
<meta property="og:type" content="article">
<meta property="og:title" content="A simplified front end architecture solution for AEM">
<meta property="og:url" content="http://aesinv.com/development/simplified-aem-frontend-sass/index.html">
<meta property="og:site_name" content="Code & Stuff">
<meta property="og:description" content="Tl;dr

Simplify your build process using some of AEM’s built-in features.
Use a Maven Sass plugin so you’re not limited to plain-old CSS or forcing back end devs to deal with gulp builds.
Create a sim">
<meta property="og:image" content="http://aesinv.com/img/aem-fe/structure-diagram.png">
<meta property="og:image" content="http://aesinv.com/img/aem-fe/component-diagram.png">
<meta property="og:image" content="http://aesinv.com/img/aem-fe/designs-diagram.png">
<meta property="og:updated_time" content="2017-03-06T13:46:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A simplified front end architecture solution for AEM">
<meta name="twitter:description" content="Tl;dr

Simplify your build process using some of AEM’s built-in features.
Use a Maven Sass plugin so you’re not limited to plain-old CSS or forcing back end devs to deal with gulp builds.
Create a sim">
<meta name="twitter:image" content="http://aesinv.com/img/aem-fe/structure-diagram.png">
  
    <link rel="alternate" href="/atom.xml" title="Code &amp; Stuff" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Code &amp; Stuff</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://aesinv.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-simplified-aem-frontend-sass" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/development/simplified-aem-frontend-sass/" class="article-date">
  <time datetime="2016-05-04T08:15:10.000Z" itemprop="datePublished">4 May, 2016</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/development/">development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      A simplified front end architecture solution for AEM
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Tl-dr"><a href="#Tl-dr" class="headerlink" title="Tl;dr"></a>Tl;dr</h2><blockquote>
<ul>
<li>Simplify your build process using some of AEM’s built-in features.</li>
<li>Use a Maven Sass plugin so you’re not limited to plain-old CSS or forcing back end devs to deal with gulp builds.</li>
<li>Create a simplified and optional gulp workflow that will sling updated files to AEM.</li>
</ul>
</blockquote>
<p><a href="http://www.adobe.com/marketing-cloud/enterprise-content-management.html" target="_blank" rel="external">AEM (Adobe Experience Manager)</a> isn’t the most front end developer friendly enterprise content management solution out there. It’s extremely heavy-handed and dependent on <a href="https://maven.apache.org/" target="_blank" rel="external">Maven</a> builds that generally don’t have access to a lot of the goodies us front end developers have grown accustom to in the instantaneous <a href="http://gulpjs.com/" target="_blank" rel="external">Gulp</a> utopia. Out of the box you’re dealing with plain-old CSS and having to wait for long builds to finish to see if your 1-line change worked, who does that anymore?</p>
<p>There are a few solutions to this problem, one being (shameless plug) <a href="https://github.com/jzeltman/iron" target="_blank" rel="external">Iron (fe)</a> which is an AEM front end framework I helped out on that includes a component generator. Iron extracts the entire front end code out into a separate, independent space then builds, bundles and pushes your front end to AEM. It works for very complex projects however it’s massive overkill for simple AEM implementations, requires some ramp-up time for devs to get use to its structure, and can also provides complications for back end developers and architects.</p>
<h2 id="A-simple-solution"><a href="#A-simple-solution" class="headerlink" title="A simple solution"></a>A simple solution</h2><p>After trying out a lot of different architectures I came up with a slightly opinionated solution that has worked extremely well so far. It keeps things simple and goes back to the question of <em>“what exactly is required for this project that AEM cannot provide out of the box?”</em></p>
<p>Let’s take a look at what this will take care of:</p>
<ul>
<li>Sass for styles compiled via Maven build (no compiled code in source control, anyone/anything can run a build)</li>
<li>JavaScript concatenation via AEM</li>
<li>Predictable file structure</li>
<li>Optional automagic builds and file deployment to AEM</li>
</ul>
<p>While that’s not a huge list of features it’s a good platform to start from for the majority of projects, and provides the bare necessities for efficient and quick front end development while not causing any headaches for architects or back end devs.</p>
<h2 id="File-Structure"><a href="#File-Structure" class="headerlink" title="File Structure"></a>File Structure</h2><p>File structure and location is completely subjective, however I will say that the structure outlined here has been the most pleasant to work with compared to other front end AEM structures I’ve worked with. I tried to put everything in predictable locations as one of my biggest pet peeves with AEM is that there are so many different directories it’s incredibly difficult to find stuff the majority of the time.</p>
<p><img src="/img/aem-fe/structure-diagram.png" alt="Front end structure diagram"></p>
<p>As you can see from the diagram above, the code is essentially split up based on type:</p>
<ul>
<li>Component-specific templates, scripts, and styles are all within <code>jcr_root/apps/{namespace}/components/content</code></li>
<li>Global/utility styles and scripts, vendor libraries, and static assets are all within <code>jcr_root/etc/designs/{namespace}/</code></li>
</ul>
<p>This more or less goes along with standard practice and means that assets are predictable and easy to find. If you’re developing a carousel component there’s no constant switching between two massively separate directories, all of the code relative to the carousel is in <em>one</em> place, it’s completely self-contained. From a maintenance point of view alone this sort of modular structure enhances maintainability and ease of onboarding massively.</p>
<p><img src="/img/aem-fe/component-diagram.png" alt="Component-specific structure diagram"></p>
<p>Given that the majority of the time you’ll have a few extra vendor libraries and a couple global/utility files (namespace creation/general event binding and library instantiation on the JavaScript side, mixin/variable declarations and shared layout/utility class declarations on the Sass side), tossing a large amount of styles and scripts randomly in the component content section would pollute that hierarchy and really isn’t semantically correct as they are design-related. That’s where the <code>etc/designs</code> hierarchy comes into play.</p>
<p><img src="/img/aem-fe/designs-diagram.png" alt="Global/utility designs structure diagram"></p>
<p>The designs section is a little more open to interpretation as every project is going to be different and everybody likes to structure things their own way. The one important caveat to note is that the main <code>.scss</code> file needs to be completely independent from the rest of the sass files, otherwise you’ll wind up with every single one of your source <code>.scss</code> files being converted into <code>.css</code> files. Trust me, you don’t want that. In the case of the diagram above, with this in mind the <code>styles/</code> directory would contain 1 file: <code>main.scss</code> and that would import the files in the <code>sass/</code> directory and get built into <code>main.css</code>.</p>
<h2 id="Getting-Sass-to-work"><a href="#Getting-Sass-to-work" class="headerlink" title="Getting Sass to work"></a>Getting Sass to work</h2><p>Now that we’ve got a general idea of where things should go we can start setting up some scaffolding and get an actual build running. We’ll start with getting our <a href="https://maven.apache.org/" target="_blank" rel="external">Maven</a> build compiling Sass first since that’s the biggest hurdle.</p>
<p>Before we continue, there are ways to have Maven download and install npm and everything necessary to run your build at run time, however I’ve seen this work inconsistently and I’ve heard it can cause issues on some environments. What we’re after is a simplified solution that will run anywhere, anytime consistently.</p>
<h3 id="The-Maven-build"><a href="#The-Maven-build" class="headerlink" title="The Maven build"></a>The Maven build</h3><p>I’ve tried a few different Maven plugins for Sass compilation, and so far my favorite has been the <a href="https://github.com/warmuuh/libsass-maven-plugin" target="_blank" rel="external">libsass-maven-plugin</a> by <a href="https://github.com/warmuuh" target="_blank" rel="external">@warmuuh</a>. It’s essentially just a wrapper for libsass so it’s very robust in the options it provides, however there are some limitations that you may have to play around with to find workarounds.</p>
<p>All we have to do is add the plugin to our UI pom and configure it to use the correct files and paths.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- /(namespace)-ui/pom.xml --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.warmuuh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>libsass-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.6-libsass_3.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>compile-sass<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">inputPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/content/jcr_root/etc/designs/(namespace)/styles<span class="tag">&lt;/<span class="name">inputPath</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">includePath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/content/jcr_root/etc/designs/(namespace)/sass:$&#123;project.basedir&#125;/src/main/content/jcr_root/apps/(namespace)/components<span class="tag">&lt;/<span class="name">includePath</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">outputPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/content/jcr_root/etc/designs/(namespace)/css<span class="tag">&lt;/<span class="name">outputPath</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">outputStyle</span>&gt;</span>compressed<span class="tag">&lt;/<span class="name">outputStyle</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generateSourceMap</span>&gt;</span>true<span class="tag">&lt;/<span class="name">generateSourceMap</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">sourceMapOutputPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/content/jcr_root/etc/designs/(namespace)/css<span class="tag">&lt;/<span class="name">sourceMapOutputPath</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">omitSourceMapingURL</span>&gt;</span>true<span class="tag">&lt;/<span class="name">omitSourceMapingURL</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- . . . --&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure>
<p>It’s a pretty typical plugin definition until we get to the configuration block, which is where the magic happens. We’re doing the following:</p>
<ul>
<li><code>&lt;inputPath&gt;</code>: Tell it to use our main files directory as the source. It will compile every single <code>.scss</code> file inside of this directory, so its best to have your main file separated from the rest of your code for this reason.</li>
<li><code>&lt;includePath&gt;</code>: Set both our main source code directory (<code>etc/designs/namespace/sass</code>) and component content directory (<code>apps/namespace/components</code>) as paths the compiler should look in when handling an <code>@import</code> declaration.</li>
<li><code>&lt;outputPath&gt;</code>: Set where the compiled css file should be saved.</li>
<li><code>&lt;outputStyle&gt;</code>: Tell it to compress (minify) the output.</li>
<li><code>&lt;generateSourceMap&gt;</code>: Have the compiler also generate a source map for easier debugging during development.</li>
<li><code>&lt;sourceMapOutputPath&gt;</code>: Tell the compiler where the compiled source map should be saved.</li>
<li><code>&lt;omitSourceMapingURL&gt;</code>: That property name isn’t a typo. This just tells the compiler to not automatically inject the source map URL into the finished <code>.css</code> file. This was something that needs to be set to true and a URL manually added to the main sass file for Source Maps to work an, I found out the hard way.</li>
</ul>
<p>Now if we had any code in those directories and we ran a Maven build we’d wind up with a compiled css file and source map wherever we told the compiler to save them. Saucy!</p>
<h3 id="Setting-up-some-Sass-scaffolding"><a href="#Setting-up-some-Sass-scaffolding" class="headerlink" title="Setting up some Sass scaffolding"></a>Setting up some Sass scaffolding</h3><p>I won’t go too much in detail in this section, but rather go over some caveats and provide an example of how you could get up and running quickly. The example will include <a href="http://getbootstrap.com/" target="_blank" rel="external">Bootstrap</a>, but can obviously be altered to use any front end framework such as <a href="http://foundation.zurb.com/" target="_blank" rel="external">Foundation</a> or <a href="http://semantic-ui.com/" target="_blank" rel="external">Semantic UI</a>.</p>
<h4 id="The-globals-sass-source-directory"><a href="#The-globals-sass-source-directory" class="headerlink" title="The globals/sass source directory"></a>The globals/sass source directory</h4><p>We’ll start out with the <code>etc/designs/namespace/sass</code> directory, or our actual <em>Sass source</em>. Since every project I implement Bootstrap on it winds up getting heavily extended and customized, I prefer to include the actual Bootstrap source so I can hand pick exactly what gets built and what gets ignored. The source would get tossed into the <em>Sass source</em> directory into a directory <code>bootstrap/</code>. Along with the source code of our framework of choice we’d create some global/utility sass files that we can use for general Sass environment setup and shared or utility classes. Here’s an example of what this directory may look like after this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">bootstrap/          <span class="comment">// The source code for our framework of choice.</span></div><div class="line">_variables.scss     <span class="comment">// Site-wide Sass variables.</span></div><div class="line">_mixins.scss        <span class="comment">// Any custom mixins your code requires.</span></div><div class="line">_utils.scss         <span class="comment">// Utility classes such as floats, clears, show/hide classes.</span></div><div class="line">components.scss     <span class="comment">// Component bulk-import file.</span></div><div class="line">layout.scss         <span class="comment">// Layout-specific styles, such as page template scaffolding.</span></div><div class="line">icons.scss          <span class="comment">// Custom icon declarations.</span></div><div class="line">forms.scss          <span class="comment">// Global form styles.</span></div><div class="line">typography.scss     <span class="comment">// Global typography such as headers, color options, links, etc.</span></div><div class="line">globals.scss        <span class="comment">// Global styles that don't really fit in anywhere else.</span></div></pre></td></tr></table></figure>
<p>By far and away the most important file in the above example is <code>components.scss</code>, which bulk-<code>@import</code>‘s all component styles for inclusion in the style sheet. This makes important use of that <code>includePath</code> property we set in the Sass compiler plugin so that the <code>@import</code> declarations are far more readable than they would be otherwise:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// etc/designs/namespace/sass/components.scss</div><div class="line"></div><div class="line">/* . . . */</div><div class="line">@import "content/carousel/carousel.scss";</div><div class="line">@import "content/linkedlist/linkedlist.scss";</div><div class="line">/* . . . */</div></pre></td></tr></table></figure>
<p>Since we set that include path, we can request the component files relative to the component content. Super cool! One observation I will note from the last project using this structure was that sometimes I would find this file somewhat inconvenient to get to all the way over here in designs. Semantically it works great, but if I didn’t already have the file open in my editor I was always a bit annoyed to have to go all the way over to the designs directory to open it up and add a new component. That being said, you could probably move it somewhere closer to the components and it would be totally fine, such as <code>apps/namespace/components/components.scss</code>.</p>
<h4 id="The-main-file"><a href="#The-main-file" class="headerlink" title="The main file"></a>The main file</h4><p>Now we’ll add our main file that will be used by the compiler to compile our stylesheet. This is in that <code>etc/designs/namespace/styles</code> directory, and can be named whatever you want. I have a habit of naming it <code>main.scss</code> so I can expect the resulting css file to be <code>main.css</code>. This file is essentially just a bulk-importing file that will go through and import all of globals and framework files, followed by all of the components. If you chose to have the compiler generate a Source Map this file will also need a comment of the URL of the compiled source map added to the bottom of it.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">// etc/designs/namespace/styles/main.scss</div><div class="line"></div><div class="line">// Custom Variables and mixins</div><div class="line">@import "variables";</div><div class="line">@import "mixins";</div><div class="line">@import "icons";</div><div class="line"></div><div class="line">// Bootstrap imports</div><div class="line">/*</div><div class="line">  Removing vast majority of them since there are so many,</div><div class="line">  but you essentially just copy the entire `bootstrap.scss`</div><div class="line">  file into here with your own overrides scattered in between.</div><div class="line">*/</div><div class="line">@import "bootstrap/variables";</div><div class="line">@import "bootstrap/mixins";</div><div class="line">// More bootstrap imports...</div><div class="line"></div><div class="line">// Core Overrides</div><div class="line">@import "type";</div><div class="line">@import "layout";</div><div class="line"></div><div class="line">// Bootstrap Components...</div><div class="line"></div><div class="line">// Globals</div><div class="line">@import "utils";</div><div class="line">@import "forms";</div><div class="line">@import "globals";</div><div class="line"></div><div class="line">// Components</div><div class="line">@import "components";</div><div class="line"></div><div class="line">/*!# sourceMappingURL=namespace/css/main.css.map */</div></pre></td></tr></table></figure>
<p>The file is a pretty standard main file, with the exception of the source map URL declaration at the very bottom. I tried to remove as much of the Bootstrap stuff as I could to save space, but I left some to show how you’d include them thanks to the relative include paths.</p>
<h4 id="Some-dummy-component-files"><a href="#Some-dummy-component-files" class="headerlink" title="Some dummy component files"></a>Some dummy component files</h4><p>Now I’ll just show some dummy components to give you the idea of how you’ll import them. Let’s say we have a super complex component we need to create called the List component, back end has already finished the backing class for it and it just needs front end now. First we’ll go in and add that file to our <code>components.scss</code> file:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// etc/designs/namespace/sass/components.scss</div><div class="line"></div><div class="line">@import "content/carousel/carousel.scss";</div><div class="line">@import "content/linkedlist/linkedlist.scss";</div><div class="line">@import "content/list/list.scss";   // Our new component</div></pre></td></tr></table></figure>
<p>Then we’d just create the <code>.scss</code> file in it’s component folder. Easy peazy.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// apps/namespace/components/content/list/list.scss</div><div class="line"></div><div class="line">ul.namespace-list &#123;</div><div class="line">  list-style: none;</div><div class="line">  padding-left: 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Creating-clientlibs"><a href="#Creating-clientlibs" class="headerlink" title="Creating clientlibs"></a>Creating clientlibs</h2><p>At this stage if we were to run a Maven build we’d wind up with shiny new <code>main.css</code> and <code>main.css.map</code> files in our <code>etc/designs/namespace/css</code> directory. As great as that is, as far as AEM is concerned there are just some annoying files filling up precious space and not doing anything, so now is a perfect time to start creating some clientlibs.</p>
<p>We’re going to wind up having 3 different clientlib categories:</p>
<ul>
<li><code>namespace-frontend.design</code>: Main clientlib category containing all of the global styles and scripts.</li>
<li><code>namespace-frontend.components</code>: A complimentary design category that will be embedded into the main category.</li>
<li><code>namespace-frontend.vendor</code>: All of our vendor/external clientlibs.</li>
</ul>
<h3 id="Our-main-clientlib"><a href="#Our-main-clientlib" class="headerlink" title="Our main clientlib"></a>Our main clientlib</h3><p>We’ll start with the <code>namespace-frontend.designs</code> clientlib since that’s our main clientlib that will be included in our templates. We embed the components clientlib category in this one</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- etc/designs/namespace/.content.xml --&gt;</span></div><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">jcr:root</span> <span class="attr">xmlns:sling</span>=<span class="string">"http://sling.apache.org/jcr/sling/1.0"</span> <span class="attr">xmlns:jcr</span>=<span class="string">"http://www.jcp.org/jcr/1.0"</span> <span class="attr">xmlns:rep</span>=<span class="string">"internal"</span></span></div><div class="line">    <span class="attr">jcr:mixinTypes</span>=<span class="string">"[rep:AccessControllable]"</span></div><div class="line">    <span class="attr">jcr:primaryType</span>=<span class="string">"cq:ClientLibraryFolder"</span></div><div class="line">    <span class="attr">sling:resourceType</span>=<span class="string">"widgets/clientlib"</span></div><div class="line">    <span class="attr">embed</span>=<span class="string">"[namespace-frontend.components]"</span></div><div class="line">    <span class="attr">categories</span>=<span class="string">"[namespace-frontend.design]"</span></div><div class="line">  /&gt;</div></pre></td></tr></table></figure>
<p>With that in our design root we’ll then just set our main compiled CSS file to be included in this clientlib as well as any javascript files we need. The only thing of note here is that we’re embedding our component category into this clientlib so that it will be included whenever we inject this clientlib into our templates.</p>
<pre>
# etc/designs/namespace/css.txt
#base=css

main.css
</pre>
<pre>
# etc/designs/namespace/js.txt
#base=js

main.js
utils.js
</pre>

<p>This should be pretty standard for anybody who has made clientlibs before, all we’re doing is directing the clientlib to our files.</p>
<h3 id="Vendor-libraries"><a href="#Vendor-libraries" class="headerlink" title="Vendor libraries"></a>Vendor libraries</h3><p>Chances are you’re going to need to include some sort of JavaScript or CSS library on your project, so that’s where our vendor clientlib comes into play. This is going to be a separate category than our main design clientlib, so we’re tossing this into the <code>vendor/</code> directory of our design directory.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- etc/designs/namespace/vendor/.content.xml --&gt;</span></div><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">jcr:root</span> <span class="attr">xmlns:sling</span>=<span class="string">"http://sling.apache.org/jcr/sling/1.0"</span> <span class="attr">xmlns:jcr</span>=<span class="string">"http://www.jcp.org/jcr/1.0"</span> <span class="attr">xmlns:rep</span>=<span class="string">"internal"</span></span></div><div class="line">    <span class="attr">jcr:mixinTypes</span>=<span class="string">"[rep:AccessControllable]"</span></div><div class="line">    <span class="attr">jcr:primaryType</span>=<span class="string">"cq:ClientLibraryFolder"</span></div><div class="line">    <span class="attr">sling:resourceType</span>=<span class="string">"widgets/clientlib"</span></div><div class="line">    <span class="attr">categories</span>=<span class="string">"[namespace-frontend.vendor]"</span></div><div class="line">  /&gt;</div></pre></td></tr></table></figure>
<p>In typical AEM fashion, the libraries going in the <code>vendor/</code> directory get split up into <code>css/</code> and <code>js/</code> directories, which we’ll just include via the <code>css.txt</code> and <code>js.txt</code> files in the vendor root.</p>
<pre>
# etc/designs/namespace/vendor/js.txt
#base=js

bootstrap.carousel.js
bootstrap.collapse.js
jquery.validate.js
</pre>

<h3 id="Adding-component-scripts"><a href="#Adding-component-scripts" class="headerlink" title="Adding component scripts"></a>Adding component scripts</h3><p>Now we’ve got all of our vendor libraries set up, our main scripts and all of our styles ready to go, but now it’s time to get component-specific javascript hooked into everything. This is where we’re going to make use of that <code>namespace-frontend.components</code> clientlib category.  Each component that requires a script will have it’s own clientlib declaration that mates it to that category, which if you’ll remember from earlier is being embedded into our main designs clientlib.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- apps/namespace/components/content/linkedlist/js/.content.xml --&gt;</span></div><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">jcr:root</span> <span class="attr">xmlns:sling</span>=<span class="string">"http://sling.apache.org/jcr/sling/1.0"</span> <span class="attr">xmlns:jcr</span>=<span class="string">"http://www.jcp.org/jcr/1.0"</span> <span class="attr">xmlns:rep</span>=<span class="string">"internal"</span></span></div><div class="line">    <span class="attr">jcr:mixinTypes</span>=<span class="string">"[rep:AccessControllable]"</span></div><div class="line">    <span class="attr">jcr:primaryType</span>=<span class="string">"cq:ClientLibraryFolder"</span></div><div class="line">    <span class="attr">sling:resourceType</span>=<span class="string">"widgets/clientlib"</span></div><div class="line">    <span class="attr">categories</span>=<span class="string">"[namespace-frontend.components]"</span></div><div class="line">  /&gt;</div></pre></td></tr></table></figure>
<pre>
# apps/namespace/components/content/linkedlist/js/js.txt
linkedlist.js
linkedlist.item.js
</pre>

<p>It’s worth noting that the structure of the component directory is completely subjective. You can have something like:</p>
<pre>
apps/namespace/components/content/linkedlist/
  js/
    .content.xml
    js.txt
    linkedlist.js
</pre>

<p>or:</p>
<pre>
apps/namespace/components/content/linkedlist/
  .content.xml
  js.txt
  js/
    linkedlist.js
</pre>

<p>The concept is the same, so use whichever structure works for you and your project.</p>
<h3 id="Adding-our-clientlibs-to-templates"><a href="#Adding-our-clientlibs-to-templates" class="headerlink" title="Adding our clientlibs to templates"></a>Adding our clientlibs to templates</h3><p>This should be pretty trivial to anyone who is already well-versed in clientlibs in AEM, so I won’t go into extreme detail on this. All you need to do is include the main design clientlib category and our vendor clientlib. I generally have my vendor libraries included before my main designs.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- apps/namespace/components/page/global/head.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">data-sly-use.clientLib</span>=<span class="string">"$&#123;'/libs/granite/sightly/templates/clientlib.html'&#125;"</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">sly</span> <span class="attr">data-sly-unwrap</span> <span class="attr">data-sly-call</span>=<span class="string">"$&#123;clientLib.css @ categories='namespace-frontend.vendor'&#125;"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">sly</span> <span class="attr">data-sly-unwrap</span> <span class="attr">data-sly-call</span>=<span class="string">"$&#123;clientLib.css @ categories='namespace-frontend.design'&#125;"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- apps/namespace/components/page/global/body.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">data-sly-use.clientLib</span>=<span class="string">"$&#123;'/libs/granite/sightly/templates/clientlib.html'&#125;"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">id</span>=<span class="string">"header"</span> <span class="attr">data-sly-include</span>=<span class="string">"header.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span> <span class="attr">class</span>=<span class="string">"container"</span> <span class="attr">data-sly-include</span>=<span class="string">"content.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">footer</span> <span class="attr">id</span>=<span class="string">"footer"</span> <span class="attr">data-sly-include</span>=<span class="string">"footer.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">sly</span> <span class="attr">data-sly-unwrap</span> <span class="attr">data-sly-call</span>=<span class="string">"$&#123;clientLib.js @ categories='namespace-frontend.vendor'&#125;"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">sly</span> <span class="attr">data-sly-unwrap</span> <span class="attr">data-sly-call</span>=<span class="string">"$&#123;clientLib.js @ categories='namespace-frontend.design'&#125;"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Now we have a working Sass build via Maven, component styles/scripts in predictable locations, connected global/utility styles/scripts and vendor libraries. If you have no need for Gulp automation for quicker builds and code deployment to AEM you should be ready to start developing. If not, all that’s left is setting up our optional Gulp build.</p>
<h2 id="Gulp-Automation-for-the-time-savings"><a href="#Gulp-Automation-for-the-time-savings" class="headerlink" title="Gulp Automation for the time-savings"></a>Gulp Automation for the time-savings</h2><p>One of the things that really bugs me about most standard AEM setups is that if I need to make a 1-line change to some CSS, JavaScript or template my only options are using CRX/DE (yuck) or running a full Maven build (yuck). Let’s bring this build into the modern era with a gulp setup that will automagically sling our compiled Sass and other files to AEM on file change so we’re not stuck waiting for slow Maven build.</p>
<p>For the bare minimum all you really need as far as <a href="https://www.npmjs.com/" target="_blank" rel="external">npm</a> packages go is <a href="https://www.npmjs.com/package/gulp-slang" target="_blank" rel="external">gulp-slang</a> to auto-sling the files to AEM, which you can then fire off in a task or watch block.</p>
<p>If you’re interested in an example gulp file, we’ll set up one with sass compilation, <a href="http://jshint.com/" target="_blank" rel="external">jslinting</a> and auto-slinging whenever a style, script, or template is updated. First off we need to install some <a href="https://www.npmjs.com/" target="_blank" rel="external">npm</a> packages in our absolute project root and initialize our npm project:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">npm init</div><div class="line"></div><div class="line"><span class="comment"># utils</span></div><div class="line">npm install --save-dev gulp gulp-watch gulp-plumber gulp-rename gulp-util gulp-watch</div><div class="line"></div><div class="line"><span class="comment"># style-related</span></div><div class="line">npm install --save-dev gulp-sass gulp-sourcemaps</div><div class="line"></div><div class="line"><span class="comment"># script related</span></div><div class="line">npm install --save-dev jshint gulp-jshint</div><div class="line"></div><div class="line"><span class="comment"># aem related</span></div><div class="line">npm install --save-dev gulp-slang</div></pre></td></tr></table></figure>
<p>From there we can start on our <code>gulpfile.js</code> by requiring everything we need up at the top of the file:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// gulpfile.js</span></div><div class="line"><span class="comment">/* Requires */</span></div><div class="line"><span class="keyword">var</span> gulp        = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</div><div class="line">    watch       = <span class="built_in">require</span>(<span class="string">'gulp-watch'</span>),</div><div class="line">    <span class="comment">// Utilities</span></div><div class="line">    gutil       = <span class="built_in">require</span>(<span class="string">'gulp-util'</span>),</div><div class="line">    plumber     = <span class="built_in">require</span>(<span class="string">'gulp-plumber'</span>),</div><div class="line">    slang       = <span class="built_in">require</span>(<span class="string">'gulp-slang'</span>),</div><div class="line">    rename      = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>),</div><div class="line">    <span class="comment">// Styles</span></div><div class="line">    sass        = <span class="built_in">require</span>(<span class="string">'gulp-sass'</span>),</div><div class="line">    sourcemaps  = <span class="built_in">require</span>(<span class="string">'gulp-sourcemaps'</span>),</div><div class="line">    <span class="comment">// Scripts</span></div><div class="line">    jshint      = <span class="built_in">require</span>(<span class="string">'gulp-jshint'</span>);</div></pre></td></tr></table></figure>
<p>We then want to specify the paths that we need. This helps readability and maintainability, as namespaces can sometimes change mid-project and if you don’t have relative paths this can be a <em>nightmare</em> to refactor.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// gulpfile.js, continued</span></div><div class="line"><span class="comment">/* Requires */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* Paths */</span></div><div class="line"><span class="keyword">var</span> root        = <span class="string">'namespace-ui/src/main/content/jcr_root/'</span>,</div><div class="line">    components  = root + <span class="string">'apps/namespace/components/'</span>,</div><div class="line">    designs     = root + <span class="string">'etc/designs/namespace/'</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Styles</span></div><div class="line">    cssPath     = designs + <span class="string">'css/'</span>,</div><div class="line">    sassPath    = designs + <span class="string">'sass/'</span>,</div><div class="line">    mainCss     = designs + <span class="string">'styles/main.scss'</span>,</div><div class="line">    cssBuild    = cssPath + <span class="string">'main.css'</span>,</div><div class="line">    cssSrcMaps  = cssPath + <span class="string">'main.css.map'</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Scripts</span></div><div class="line">    jsPath      = designs + <span class="string">'js/'</span>,</div><div class="line">    vendorPath  = designs + <span class="string">'vendor/'</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Images</span></div><div class="line">    imgPath     = designs + <span class="string">'img/'</span>;</div></pre></td></tr></table></figure>
<p>I generally like my console nice and colorful, so before any tasks I usually include some sort of colorful event notification utility function:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// gulpfile.js, continued</span></div><div class="line"><span class="comment">/* Requires */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* Paths */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Helper: changeNotification</div><div class="line"> * Logs an event to the console.</div><div class="line"> *</div><div class="line"> * @param &#123;String&#125; fType - The file type that was changed.</div><div class="line"> * @param &#123;String&#125; eType - The event that occured.</div><div class="line"> * @param &#123;String&#125; msg - Short description of the actions that are being taken.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeNotification</span>(<span class="params">fType, eType, msg</span>) </span>&#123;</div><div class="line">  gutil.log(gutil.colors.cyan.bold(fType), <span class="string">'was'</span>, gutil.colors.yellow.bold(eType) + <span class="string">'.'</span>, msg);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we need to set up our sass builds. The key here is to try to replicate the sass build that the Maven build does as closely as possible so there are no noticeable differences between the Gulp build and Maven build. We do this by configuring sass with the same settings we authored in our pom file, creating a task that we can reference in other tasks as well as fire off ourselves when needed, then setting up a task to sling the shiny new files to AEM.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// gulpfile.js, continued</span></div><div class="line"><span class="comment">/* Requires */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* Paths */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* changeNotification */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Task: `sass:build`</div><div class="line"> * Compiles the sass and writes sourcemaps.</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'sass:build'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</div><div class="line">    gulp.src(mainCss)</div><div class="line">        .pipe(plumber()) <span class="comment">// Prevents pipe breaking due to error (for watch task)</span></div><div class="line">        .pipe(sourcemaps.init())</div><div class="line">        .pipe(sass(&#123;</div><div class="line">            <span class="attr">outputStyle</span>: <span class="string">'compressed'</span>,</div><div class="line">            <span class="attr">omitSourceMapUrl</span>: <span class="literal">true</span>, <span class="comment">// This is hardcoded in the main.scss due to resource path issues</span></div><div class="line">            includePaths: [sassPath, components]</div><div class="line">        &#125;).on(<span class="string">'error'</span>, sass.logError))</div><div class="line">        .pipe(sourcemaps.write(<span class="string">'./'</span>, &#123;</div><div class="line">            <span class="attr">addComment</span>: <span class="literal">false</span></div><div class="line">        &#125;))</div><div class="line">        .pipe(plumber.stop())</div><div class="line">        .pipe(gulp.dest(cssPath));</div><div class="line"></div><div class="line">  <span class="comment">// Fire the callback Gulp passes in to tell it we're done</span></div><div class="line">  cb();</div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Task: `sass:sling`</div><div class="line"> * Slings the compiled stylesheet and sourcemaps to AEM.</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'sass:sling'</span>, [<span class="string">'sass:build'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> gulp.src([cssBuild, cssSrcMaps])</div><div class="line">    .pipe(slang());</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Task: `sass`</div><div class="line"> * Runs the sass build and slings the results to AEM.</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'sass'</span>, [<span class="string">'sass:build'</span>, <span class="string">'sass:sling'</span>]);</div></pre></td></tr></table></figure>
<p>Next up our JavaScript task, which in this particular instance is extremely light. All we’ll be doing is setting up some simple jslinting to keep silly errors at bay in our JS. We won’t be minifying the JS as that can be done by AEM out of the box, and we want to make sure this Gulp build is complementary to the Maven build, not a pre-requisite.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// gulpfile.js, continued</span></div><div class="line"><span class="comment">/* Requires */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* Paths */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* changeNotification */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* Sass tasks */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Task: `js:lint`</div><div class="line"> * Lints project JS, excluding vendor libs.</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'js:lint'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> gulp.src([components + <span class="string">'**/*.js'</span>, jsPath + <span class="string">'**/*.js'</span>])</div><div class="line">    .pipe(jshint())</div><div class="line">    .pipe(jshint.reporter(<span class="string">'default'</span>));</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Last up will be our watch task, which will monitor all template files, scripts and styles for changes so that it can kick off builds immediately. We’re going to set up a watch stream for each type of file, which will then kick off a build or deployment for that particular type of code.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// gulpfile.js, continued</span></div><div class="line"><span class="comment">/* Requires */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* Paths */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* changeNotification */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* Sass tasks */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"><span class="comment">/* JS tasks */</span></div><div class="line"><span class="comment">// . . .</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Task: `watch`</div><div class="line"> * Watches the HTML, Sass, and JS for changes. On a file change,</div><div class="line"> * will run builds file-type dependently and sling the new files</div><div class="line"> * up to AEM.</div><div class="line"> */</div><div class="line">gulp.task(<span class="string">'watch'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  gutil.log(<span class="string">'Waiting for changes.'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Set up our streams</span></div><div class="line">  <span class="keyword">var</span> jsWatch = gulp.watch([components + <span class="string">'**/*.js'</span>, jsPath + <span class="string">'**/*.js'</span>], [<span class="string">'js:lint'</span>]),</div><div class="line">      sassWatch = gulp.watch([components + <span class="string">'**/*.scss'</span>, mainCss, sassPath + <span class="string">'**/*.scss'</span>], [<span class="string">'sass'</span>]),</div><div class="line">      markupWatch = gulp.watch([components + <span class="string">'**/**/*.html'</span>, components + <span class="string">'**/**/*.jsp'</span>]),</div><div class="line">      imgWatch = gulp.watch([imgPath + <span class="string">'**/*'</span>]);</div><div class="line"></div><div class="line">  <span class="comment">// js needs to be linted</span></div><div class="line">  jsWatch.on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123;</div><div class="line">    changeNotification(<span class="string">'JS file'</span>, ev.type, <span class="string">'Linting code &amp; slinging to AEM.'</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> gulp.src(ev.path)</div><div class="line">      .pipe(slang(ev.path));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// Sass needs to get built and slung up</span></div><div class="line">  sassWatch.on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123;</div><div class="line">    changeNotification(<span class="string">'Sass file'</span>, ev.type, <span class="string">'Running compilation &amp; slinging to AEM.'</span>);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">// Markup just needs to be slung to AEM</span></div><div class="line">  markupWatch.on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123;</div><div class="line">    changeNotification(<span class="string">'Sightly file'</span>, ev.type, <span class="string">'Slinging file to AEM.'</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> gulp.src(ev.path)</div><div class="line">      .pipe(slang(ev.path));</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// Images just need to be slung to AEM</span></div><div class="line">  imgWatch.on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123;</div><div class="line">    changeNotification(<span class="string">'Image file'</span>, ev.type, <span class="string">'Slinging file to AEM.'</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> gulp.src(ev.path)</div><div class="line">      .pipe(slang(ev.path));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>So a quick recap on the commands this gulp build provides:</p>
<ul>
<li><code>gulp watch</code> - Watches for changes to JavaSript, CSS/Sass, and HTML files, runs any necessary subtasks and slings the result to AEM.</li>
<li><code>gulp sass</code> - Builds all Sass files and slings the compiled stylesheet and source maps to AEM.</li>
<li><code>gulp js:lint</code> - Runs all JavaScript files against JSHint and outputs the results to the console.</li>
</ul>
<p>Now, if we run <code>gulp watch</code> any component-level and global changes will automagically be built and slung to AEM far faster than it would take to run a Maven build. The best part of this is that it allows for easier front end development, but also allows for the front end to not add any more dependencies to the project that back end devs may not want to deal with. Plus, you don’t have to check in any compiled code to version control as the Maven build will generate the compiled code every time.</p>
<p>If you’d like to check out the gulpfile more in-depth, you can view it in its entirety <a href="https://github.com/aesinv/simple-aem-fe-example/blob/master/gulpfile.js" target="_blank" rel="external">on Github</a>. You can also browse through a full example of this hierarchy with all of the code from this post in place via <a href="https://github.com/aesinv/simple-aem-fe-example" target="_blank" rel="external">this repo</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://aesinv.com/development/simplified-aem-frontend-sass/" data-id="cizy4qyeh000bahpgre33qjgq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/adobe-cq/">adobe cq</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aem/">aem</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gulp/">gulp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maven/">maven</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sass/">sass</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/development/passing-data-from-aem6-to-javascript/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Different ways to pass data from AEM6 to Javascript
        
      </div>
    </a>
  
  
    <a href="/game-dev/keeping-the-user-entertained-when-they-fail/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Game Dev Log: Keeping the player entertained when they fail</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">development</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/game-dev/">game dev</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Internet-of-Things/">Internet of Things</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IoT/">IoT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adobe-cq/">adobe cq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aem/">aem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aem6/">aem6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/beacons/">beacons</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-along/">code along</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crying-yourself-to-sleep/">crying yourself to sleep</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/device-motion/">device motion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dungeon-crawler/">dungeon crawler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/experimental-tech/">experimental tech</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/game-development/">game development</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-issues/">git issues</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gulp/">gulp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ibeacon/">ibeacon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jekyll/">jekyll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sass/">sass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sightly/">sightly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unity/">unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utilities/">utilities</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/workflow/">workflow</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Internet-of-Things/" style="font-size: 10px;">Internet of Things</a> <a href="/tags/IoT/" style="font-size: 10px;">IoT</a> <a href="/tags/adobe-cq/" style="font-size: 15px;">adobe cq</a> <a href="/tags/aem/" style="font-size: 10px;">aem</a> <a href="/tags/aem6/" style="font-size: 10px;">aem6</a> <a href="/tags/beacons/" style="font-size: 10px;">beacons</a> <a href="/tags/code-along/" style="font-size: 10px;">code along</a> <a href="/tags/crying-yourself-to-sleep/" style="font-size: 10px;">crying yourself to sleep</a> <a href="/tags/device-motion/" style="font-size: 10px;">device motion</a> <a href="/tags/dungeon-crawler/" style="font-size: 10px;">dungeon crawler</a> <a href="/tags/experimental-tech/" style="font-size: 10px;">experimental tech</a> <a href="/tags/game-development/" style="font-size: 15px;">game development</a> <a href="/tags/games/" style="font-size: 10px;">games</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/git-issues/" style="font-size: 10px;">git issues</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/gulp/" style="font-size: 15px;">gulp</a> <a href="/tags/ibeacon/" style="font-size: 10px;">ibeacon</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/sass/" style="font-size: 10px;">sass</a> <a href="/tags/sightly/" style="font-size: 10px;">sightly</a> <a href="/tags/unity/" style="font-size: 10px;">unity</a> <a href="/tags/utilities/" style="font-size: 10px;">utilities</a> <a href="/tags/workflow/" style="font-size: 10px;">workflow</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/uncategorized/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/development/fixing-git-push-pull-timeout/">Fixing git push/pull timing out</a>
          </li>
        
          <li>
            <a href="/development/passing-data-from-aem6-to-javascript/">Different ways to pass data from AEM6 to Javascript</a>
          </li>
        
          <li>
            <a href="/development/simplified-aem-frontend-sass/">A simplified front end architecture solution for AEM</a>
          </li>
        
          <li>
            <a href="/game-dev/keeping-the-user-entertained-when-they-fail/">Game Dev Log: Keeping the player entertained when they fail</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Matt Bengston<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>